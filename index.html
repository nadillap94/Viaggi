<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vienna Imperiale - Guida Interattiva Modulare</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* DESIGN SYSTEM IMPERIALE */
        :root {
            --color-primary: #8C0000; /* Bordeaux Scuro (rich red) */
            --color-secondary: #C8AA50; /* Oro Antico (muted gold) */
            --color-background: #FAF8F4; /* Crema/Bianco Sporco */
            --color-text: #2c2c2c;
            --color-nav-bg: #4A4A4A; /* Grigio scuro per la navbar */
        }

        body {
            font-family: 'Georgia', serif;
            background-color: var(--color-background);
            color: var(--color-text);
        }

        /* HEADER & NAV BAR */
        .header-bg {
            background-color: var(--color-primary);
            color: white;
            border-bottom: 6px solid var(--color-secondary);
        }
        .nav-bg {
            background-color: var(--color-nav-bg); 
        }
        .nav-button {
            transition: all 0.2s;
            flex-shrink: 0; 
        }
        .nav-button:hover {
            background-color: #6C0000;
        }
        .active-tab { 
            background-color: var(--color-primary);
            font-weight: bold;
            border-bottom: 3px solid var(--color-secondary);
        }
        .intro-accent {
            color: var(--color-secondary); 
            font-weight: bold; 
        }

        /* VISUALIZZAZIONE TIMELINE */
        .accent-color { color: var(--color-primary); }
        .border-accent { border-color: var(--color-secondary); }
        .timeline-item { border-left: 2px solid var(--color-secondary); }
        .timeline-point {
            background-color: var(--color-primary);
            border: 4px solid var(--color-secondary);
        }
        .details-btn { background-color: var(--color-primary); }
        .details-btn:hover { background-color: #6C0000; }

        /* VETRINE CIBO */
        .food-showcase {
            background-color: white;
            border-top: 5px solid var(--color-primary);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        /* SEZIONI PAGINA */
        .tab-content {
            display: none; 
            min-height: 85vh; 
        }
        
        /* OTTIMIZZAZIONE PER LA STAMPA (PDF) */
        @media print {
            body { background-color: white !important; color: black !important; font-size: 10pt; }
            .fixed-element, .no-print { display: none !important; }
            .header-bg {
                background-color: white !important; color: black !important;
                border-bottom: 1px solid black !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .timeline-item { border-left: 1px dashed gray; }
            .timeline-point { background-color: white !important; border-color: black !important; }
            
            .tab-content { display: block !important; } 
            .hidden { display: block !important; } 
            
            #page-PANORAMICA, #page-GIORNO1, #page-GIORNO2, #page-GIORNO3, #page-GIORNO4, #page-CIBO, #page-BUDGET {
                 page-break-after: always; 
            }
            #page-BUDGET { page-break-after: avoid; }
        }
    </style>
</head>
<body> <header class="header-bg shadow-lg fixed top-0 w-full z-50 h-12 md:h-14 fixed-element">
        <div class="max-w-6xl mx-auto px-4 py-2 md:py-3">
            <h1 class="text-lg md:text-xl font-extrabold tracking-wider text-center pt-0.5">GUIDA VIENNA: L'EFFICACIA IMPERIALE</h1>
        </div>
    </header>

    <nav class="nav-bg fixed top-12 md:top-14 w-full z-40 shadow-xl h-10 fixed-element">
        <div class="max-w-6xl mx-auto px-4">
            <div class="flex overflow-x-auto whitespace-nowrap justify-start md:justify-center gap-1 text-sm md:text-base pt-1">
                <button onclick="showPage('page-PANORAMICA')" class="nav-button px-3 py-0.5 text-white" data-page="page-PANORAMICA">PANORAMICA</button>
                <button onclick="showPage('page-GIORNO1')" class="nav-button px-3 py-0.5 text-white" data-page="page-GIORNO1">GIORNO 1: VENERD√å 5</button>
                <button onclick="showPage('page-GIORNO2')" class="nav-button px-3 py-0.5 text-white" data-page="page-GIORNO2">GIORNO 2: SABATO 6</button>
                <button onclick="showPage('page-GIORNO3')" class="nav-button px-3 py-0.5 text-white" data-page="page-GIORNO3">GIORNO 3: DOMENICA 7</button>
                <button onclick="showPage('page-GIORNO4')" class="nav-button px-3 py-0.5 text-white" data-page="page-GIORNO4">GIORNO 4: LUNED√å 8</button>
                <button onclick="showPage('page-CIBO')" class="nav-button px-3 py-0.5 text-white" data-page="page-CIBO">CIBO</button>
                <button onclick="showPage('page-BUDGET')" class="nav-button px-3 py-0.5 text-white" data-page="page-BUDGET">BUDGET E STATISTICHE</button>
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto p-4 sm:p-6 lg:p-8 pt-[88px] md:pt-24">

        <section id="page-PANORAMICA" class="tab-content">
            <h2 class="text-3xl font-bold mb-6 pb-2 border-b border-accent accent-color flex items-center">
                <i data-lucide="scan" class="mr-2 text-2xl"></i> Panoramica Veloce: L'Essenza del Viaggio
            </h2>
            <div id="summary-container" class="space-y-6">
                <p class="text-lg italic text-gray-700">Caricamento itinerario sintetico...</p>
            </div>
        </section>

        <section id="page-GIORNO1" class="tab-content">
            <h2 class="text-3xl font-bold mb-8 pb-2 border-b border-accent accent-color flex items-center">
                <i data-lucide="calendar-check" class="mr-2 text-2xl"></i> Giorno 1: Venerd√¨ 5 - Arrivo, Arte & Concerto
            </h2>
            <p class="text-lg mb-6 bg-white p-4 rounded-lg shadow-md border-l-4 border-accent">
                <span class="intro-accent">Intro:</span> Il focus √® sull'arrivo a Vienna, l'immersione nell'arte (Hundertwasser e Hofburg) e l'esperienza del primo mercatino serale.
            </p>
            <div id="timeline-GIORNO1" class="relative mt-4"></div>
        </section>

        <section id="page-GIORNO2" class="tab-content">
            <h2 class="text-3xl font-bold mb-8 pb-2 border-b border-accent accent-color flex items-center">
                <i data-lucide="calendar-check" class="mr-2 text-2xl"></i> Giorno 2: Sabato 6 - Grand Tour di Sfarzo
            </h2>
            <p class="text-lg mb-6 bg-white p-4 rounded-lg shadow-md border-l-4 border-accent">
                <span class="intro-accent">Intro:</span> Giorno dedicato alle due principali residenze imperiali (Sch√∂nbrunn e Belvedere) e ai mercatini pi√π maestosi.
            </p>
            <div id="timeline-GIORNO2" class="relative mt-4"></div>
        </section>
        
        <section id="page-GIORNO3" class="tab-content">
            <h2 class="text-3xl font-bold mb-8 pb-2 border-b border-accent accent-color flex items-center">
                <i data-lucide="calendar-check" class="mr-2 text-2xl"></i> Giorno 3: Domenica 7 - Arte, Follia e Mercatini
            </h2>
            <p class="text-lg mb-6 bg-white p-4 rounded-lg shadow-md border-l-4 border-accent">
                <span class="intro-accent">Intro:</span> Un mix tra la grandezza del centro (Duomo), il mercato eclettico (Naschmarkt) e il grandioso mercatino di Rathausplatz.
            </p>
            <div id="timeline-GIORNO3" class="relative mt-4"></div>
        </section>

        <section id="page-GIORNO4" class="tab-content">
            <h2 class="text-3xl font-bold mb-8 pb-2 border-b border-accent accent-color flex items-center">
                <i data-lucide="calendar-check" class="mr-2 text-2xl"></i> Giorno 4: Luned√¨ 8 - Ultimi Dettagli & Ritorno
            </h2>
            <p class="text-lg mb-6 bg-white p-4 rounded-lg shadow-md border-l-4 border-accent">
                <span class="intro-accent">Intro:</span> Ultimo giorno dedicato alla colazione in Konditorei e al transfer per l'aeroporto.
            </p>
            <div id="timeline-GIORNO4" class="relative mt-4"></div>
        </section>

        <section id="page-CIBO" class="tab-content">
            <h2 class="text-3xl font-bold mb-8 pb-2 border-b border-accent accent-color flex items-center">
                <i data-lucide="utensils" class="mr-2 text-2xl"></i> Delizie Culinarie di Vienna
            </h2>
            <div id="food-showcases" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div id="showcase-piatti" class="food-showcase p-5 rounded-xl">
                    <h3 class="text-2xl font-bold accent-color mb-4">üçΩÔ∏è Piatti Tipici (Pranzi & Cene)</h3>
                </div>
                <div id="showcase-merende" class="food-showcase p-5 rounded-xl">
                    <h3 class="text-2xl font-bold accent-color mb-4">üç∞ Le Merende Reali (Dolci & Caf√©)</h3>
                </div>
                <div id="showcase-drink" class="food-showcase p-5 rounded-xl">
                    <h3 class="text-2xl font-bold accent-color mb-4">‚òï Drink (Caldi & Mercatino)</h3>
                </div>
            </div>
        </section>

        <section id="page-BUDGET" class="tab-content">
            <h2 class="text-3xl font-bold mb-8 pb-2 border-b border-accent accent-color flex items-center">
                <i data-lucide="wallet" class="mr-2 text-2xl"></i> Analisi Budget e Statistiche
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="md:col-span-1 bg-white p-6 rounded-xl shadow-xl border-l-4 border-accent">
                    <h3 class="text-xl font-bold accent-color mb-4">Riepilogo Totale</h3>
                    <p class="text-4xl font-extrabold" id="total-budget-display">‚Ç¨ XXX.XX</p>
                    <p class="text-sm mt-2 text-gray-600">Costo stimato per persona (esclusi voli).</p>
                    <div id="kpi-summary" class="mt-6 space-y-3 text-sm">
                    </div>
                </div>

                <div class="md:col-span-2 bg-white p-6 rounded-xl shadow-xl border-l-4 border-accent no-print">
                    <h3 class="text-xl font-bold accent-color mb-4">Ripartizione Costi (Grafico)</h3>
                    <div class="chart-container" style="height: 350px;">
                        <canvas id="budgetChart"></canvas>
                    </div>
                    <p class="text-center text-sm mt-4 italic text-gray-500">I costi sono stimati e arrotondati.</p>
                </div>
            </div>
        </section>

    </main>

    <script>
        // ===========================================
        // 1. DATI (Ricavati dai file CSV)
        // ===========================================
        
        // Dati Itinerario (Pianoviaggio Vienna v2 - Itinerario.csv)
        const rawItineraryData = [
            { giorno: "Giorno 1: Ven 5 - Arrivo, Arte & Concerto", ora: "04:00", attivita: "Bus Torino ‚Üí Malpensa", luogo: "Torino", note: "Logistica: Prenota il bus in anticipo (es. Flixbus/Sadem).", focus_raw: "Trasferimento iniziale. Viaggio lungo, ma economicamente efficiente. | Sveglia all'alba!" },
            { giorno: "Giorno 1: Ven 5 - Arrivo, Arte & Concerto", ora: "09:00 - 10:30", attivita: "Volo MXP ‚Üí VIE", luogo: "MXP / VIE", note: "Volo diretto Milano Malpensa ‚Üí Vienna-Schwechat.", focus_raw: "" },
            { giorno: "Giorno 1: Ven 5 - Arrivo, Arte & Concerto", ora: "11:00", attivita: "Trasferimento Aeroporto ‚Üí Hotel", luogo: "Flughafen Wien", note: "S7 da Flughafen Wien a Wien Praterstern (‚âà 28 min). Costo: Abbonamento 72h + supplemento aeroporto 2‚Ç¨.", focus_raw: "Il treno S-Bahn S7 √® la scelta pi√π economica e rapida (dopo il CAT). | Acquisto: Pass 72h + 2x Biglietti supplemento aeroporto." },
            { giorno: "Giorno 1: Ven 5 - Arrivo, Arte & Concerto", ora: "11:45", attivita: "Check-in/Deposito Bagagli", luogo: "Deluxe Living, Gro√üe Stadtgutgasse 02, Leopoldstadt (1020).", note: "L'hotel √® a 5 minuti a piedi da Praterstern.", focus_raw: "Lascia i bagagli e inizia subito l'esplorazione." },
            { giorno: "Giorno 1: Ven 5 - Arrivo, Arte & Concerto", ora: "12:15", attivita: "Pranzo e Hundertwasserhaus", luogo: "Hundertwasser Village", note: "Cibo di strada o W√ºrstel, vicino al quartiere Hundertwasser. K√§sekrainer suggerito.", focus_raw: "Il quartiere √® un'oasi di design. √à vicino all'hotel." },
            { giorno: "Giorno 1: Ven 5 - Arrivo, Arte & Concerto", ora: "13:30", attivita: "Hundertwasserhaus e Kunst Haus Wien", luogo: "Kunst Haus Wien", note: "Non si pu√≤ entrare nella Hundertwasserhaus, ma si visita la Kunst Haus (museo). Costo: 12‚Ç¨ (Hundertwasser) / 11‚Ç¨ (Museum).", focus_raw: "Museo di Friedensreich Hundertwasser, un ribelle del design." },
            { giorno: "Giorno 1: Ven 5 - Arrivo, Arte & Concerto", ora: "15:00", attivita: "Hofburg Palace e Museo di Sissi", luogo: "Hofburg, 1010 Wien", note: "Visita del complesso imperiale. Sfrutta il Vienna Pass o il biglietto combinato. Costo: ‚âà 22‚Ç¨ (Adulto).", focus_raw: "Il centro nevralgico dell'Impero Asburgico per oltre 600 anni." },
            { giorno: "Giorno 1: Ven 5 - Arrivo, Arte & Concerto", ora: "17:30", attivita: "Biblioteca Nazionale Austriaca (Sala di Stato)", luogo: "Hofburg, 1010 Wien", note: "La pi√π grande biblioteca barocca d'Europa. Imperdibile per l'architettura. Costo: ‚âà 10‚Ç¨.", focus_raw: "FOCUS FOTO: I globi celesti e gli affreschi sul soffitto." },
            { giorno: "Giorno 1: Ven 5 - Arrivo, Arte & Concerto", ora: "18:30", attivita: "Pausa Calda e Mercatino Maria-Theresien Platz", luogo: "Maria-Theresien Platz, 1010 Wien", note: "Un Gl√ºhwein o Punsch per riscaldarsi tra i due grandi musei.", focus_raw: "Mercatino scenografico tra il Kunsthistorisches e il Naturhistorisches Museum." },
            { giorno: "Giorno 1: Ven 5 - Arrivo, Arte & Concerto", ora: "20:30", attivita: "Cena e Concerto (Opzionale)", luogo: "Beisl Tradizionale / Chiesa St. Peter", note: "Schnitzel di maiale (Schwein) per restare nel budget. Dopo, concerto di musica classica (opzionale).", focus_raw: "FOCUS CULTURALE: Concerto St. Peter (se prenotato) o semplicemente relax post-cena." },

            { giorno: "Giorno 2: Sab 6 - Grand Tour di Sfarzo", ora: "10:00", attivita: "Castello di Sch√∂nbrunn", luogo: "Sch√∂nbrunn Palace, 1130 Wien", note: "Visita del 'Grand Tour' e dei giardini. Durata: 4h. Costo: ‚âà 22‚Ç¨.", focus_raw: "Residenza estiva degli Asburgo e il luogo preferito di Sissi." },
            { giorno: "Giorno 2: Sab 6 - Grand Tour di Sfarzo", ora: "14:00", attivita: "Pranzo al Mercatino di Sch√∂nbrunn", luogo: "Mercatino di Sch√∂nbrunn", note: "Pranzo veloce: K√§sekrainer o Schupfnudeln dal mercatino. Costo: ‚âà 10-15‚Ç¨.", focus_raw: "FOCUS CULINARIO: Prova i dolci o le patate fritte. √à una buona pausa pranzo a tema." },
            { giorno: "Giorno 2: Sab 6 - Grand Tour di Sfarzo", ora: "15:30", attivita: "Castello del Belvedere (Superiore)", luogo: "Belvedere, 1030 Wien", note: "Visita del museo per ammirare 'Il Bacio' di Gustav Klimt. T.T. = 2.5h. Costo: ‚âà 24‚Ç¨.", focus_raw: "Il capolavoro barocco del Principe Eugenio di Savoia e tempio dell'Art Nouveau." },
            { giorno: "Giorno 2: Sab 6 - Grand Tour di Sfarzo", ora: "18:00", attivita: "Mercatino di Karlsplatz (Artigianato)", luogo: "Karlsplatz, 1040 Wien", note: "Mercatino meno commerciale, focalizzato sull'artigianato e l'arte. Ideale per un acquisto unico.", focus_raw: "FOCUS: Prodotti unici e design. Perfetto per un regalo." },
            { giorno: "Giorno 2: Sab 6 - Grand Tour di Sfarzo", ora: "20:00", attivita: "Cena: Schnitzel o Gulasch", luogo: "Bierhof (per birra e cucina tradizionale) o Anzengruber (per Gulasch).", note: "Cena ricca, magari con una birra scura viennese.", focus_raw: "Cena in zona centrale ma fuori dal circuito turistico (zona 4 o 7)." },

            { giorno: "Giorno 3: Dom 7 - Arte, Follia e Mercatini", ora: "10:00", attivita: "St. Peter's Church (Chiesa di S. Pietro)", luogo: "Petersplatz 1, 1010 Wien", note: "Una delle chiese pi√π belle di Vienna in stile Barocco (molto vicina al Duomo).", focus_raw: "FOCUS FOTO: Interni dorati e la cupola affrescata." },
            { giorno: "Giorno 3: Dom 7 - Arte, Follia e Mercatini", ora: "11:30", attivita: "Duomo di Santo Stefano (Stephansdom)", luogo: "Stephansplatz, 1010 Wien", note: "Il simbolo gotico di Vienna. Visita alla Cattedrale (interni e tetto). Costo: ‚âà 6‚Ç¨ (Cattedrale) + ‚âà 6‚Ç¨ (Torre Sud).", focus_raw: "La torre sud offre una vista panoramica sul centro." },
            { giorno: "Giorno 3: Dom 7 - Arte, Follia e Mercatini", ora: "13:00", attivita: "Pranzo: Naschmarkt (Street Food)", luogo: "Naschmarkt, 1060 Wien", note: "Pranzo veloce ed eclettico. K√§sekrainer o cibo internazionale (es. orientale). Costo: ‚âà 8-12‚Ç¨.", focus_raw: "Mercato vivace. L'opzione 'Balkan Grill' per un Bosna (hot dog speziato) √® un must." },
            { giorno: "Giorno 3: Dom 7 - Arte, Follia e Mercatini", ora: "14:30", attivita: "Albertina Museum (Opzionale)", luogo: "Albertinaplatz 1, 1010 Wien", note: "Visita della collezione grafica di D√ºrer e Klimt. Ideale per gli amanti dell'arte. Costo: ‚âà 18‚Ç¨.", focus_raw: "La rampa di accesso offre una vista sulla Staatsoper (Opera di Stato)." },
            { giorno: "Giorno 3: Dom 7 - Arte, Follia e Mercatini", ora: "16:30", attivita: "Mercatini di Natale (Rathausplatz)", luogo: "Rathausplatz, 1010 Wien", note: "Il mercatino pi√π grande, con il maestoso Municipio illuminato.", focus_raw: "FOCUS FOTO: Il Municipio illuminato e l'atmosfera pi√π vivace." },
            { giorno: "Giorno 3: Dom 7 - Arte, Follia e Mercatini", ora: "18:30", attivita: "Furniture Museum Vienna (Opzionale)", luogo: "Museumstra√üe 6/8, 1070 Wien", note: "(Opzionale, se l'energia lo consente) Collezione imperiale di mobili. Metro U3 da Volkstheater (o vicino Rathaus) a Westbahnhof. Costo: $9‚Ç¨$.", focus_raw: "NOTA: Tappa da inserire solo se non siete troppo stanchi." },
            { giorno: "Giorno 3: Dom 7 - Arte, Follia e Mercatini", ora: "20:00", attivita: "Cena di Arrivederci (Autentica)", luogo: "Zona 7 o 8", note: "Beisl autentico (es. zona 7 o 8) per Kn√∂del (canederli) o Gulaschsuppe (zuppa).", focus_raw: "FOCUS CULINARIO: Riscaldarsi con una zuppa." },

            { giorno: "Giorno 4: Lun 8 - Ultimi Dettagli & Ritorno", ora: "09:00", attivita: "Colazione e Ultimo T√®", luogo: "Hotel/Konditorei", note: "Ultimo Kaffee und Kuchen o Sachertorte al volo.", focus_raw: "Preparare i bagagli e chiudere la camera." },
            { giorno: "Giorno 4: Lun 8 - Ultimi Dettagli & Ritorno", ora: "10:00", attivita: "Tempo Libero / Ultima Passeggiata", luogo: "Quartiere (Leopoldstadt)", note: "Ultima passeggiata nel quartiere o visita veloce (es. Minoritenkirche).", focus_raw: "" },
            { giorno: "Giorno 4: Lun 8 - Ultimi Dettagli & Ritorno", ora: "11:30", attivita: "Check-out e Spostamento in Aeroporto", luogo: "Hotel ‚Üí Aeroporto", note: "Transfer S7 o Railjet/CAT per VIE.", focus_raw: "Assicurarsi di avere il supplemento aeroporto (2‚Ç¨) se si usa l'abbonamento 72h." }
        ];

        // Dati Cibo (Pianoviaggio Vienna v2 - Cibo.csv)
        const newFoodData = {
            "Piatti tipici": [
                { titolo: "K√§sekrainer / W√ºrstel", descrizione: "Il re dello street food viennese. Salsiccia di maiale affumicata ripiena di formaggio fuso. Veloce, caldo e low-cost.", indirizzi: "Bitzinger W√ºrstelstand (vicino Praterstern). Perfetto per un pranzo veloce o spuntino. Costo: ‚âà 5-6‚Ç¨.", suggerito: "Giorno 1: 12:15 - Pranzo di Arrivo." },
                { titolo: "Wiener Schnitzel", descrizione: "La celebre cotoletta viennese. Scegli quella di maiale (Schwein) nei Beisl per risparmiare rispetto a quella di vitello (Kalb).", indirizzi: "Beisl Tradizionale / Zum Friedensrichter (Leopoldstadt) per un'opzione vicina e autentica. Costo: $12 - $18 (maiale).", suggerito: "Giorno 1: 20:30 - Cena Post-Concerto." },
                { titolo: "Gulasch", descrizione: "Stufato di manzo in salsa di paprika. Perfetto per riscaldarsi.", indirizzi: "Beisl autentico o ristorante come Anzengruber. Costo: $15 - $22.", suggerito: "Giorno 2: 20:00 - Cena (dopo il tour del Castello e Belvedere)." },
                { titolo: "Tafelspitz", descrizione: "Bollito di manzo in brodo con contorni. Piatto preferito di Franz Joseph.", indirizzi: "Ristoranti tradizionali di alta qualit√† (es. Plachutta). Costo: $25 - $35.", suggerito: "Giorno 3: 20:00 - Cena di Arrivederci (come pasto caldo e tradizionale)." },
                { titolo: "Langos / Schupfnudeln", descrizione: "Piatto ungherese fritto (Langos) o gnocchetti di patate (Schupfnudeln) dai mercatini. Low-cost.", indirizzi: "Mercatini di Natale (Rathausplatz, Sch√∂nbrunn). Costo: $5 - $8.", suggerito: "Giorno 2: 14:00 - Pranzo veloce al Mercatino di Sch√∂nbrunn." }
            ],
            "Drink": [
                { titolo: "Gl√ºhwein / Punsch", descrizione: "Vino caldo e speziato o punch (spesso con brandy o rum). Indispensabile per affrontare i mercatini. Ideale per riscaldarsi. Costo: $8 - $14.", indirizzi: "Mercatini di Natale (qualsiasi chiosco).", suggerito: "Giorno 3: 20:00 - Cena di Arrivederci (come pasto caldo e tradizionale)." }
            ],
            "Le merende reali": [
                { titolo: "Pausa Caf√©/Atmosfera", descrizione: "Non un piatto, ma l'esperienza essenziale del caff√® viennese in un ambiente storico.", indirizzi: "Caf√© Central (Interni maestosi, low-cost se si ordina solo una bevanda). Costo: ‚âà 5‚Ç¨ per un Melange.", suggerito: "Giorno 2: 17:30 - Pausa Calda (dopo la Biblioteca Nazionale)." },
                { titolo: "Apfelstrudel", descrizione: "Sfoglia sottile ripiena di mele, uvetta e cannella, servita calda (spesso con salsa alla vaniglia).", indirizzi: "Mercatini di Natale o qualsiasi Konditorei (pasticceria).", suggerito: "Giorno 3: 16:00 - Merenda Calda durante il Mercatino di Rathausplatz." },
                { titolo: "Sachertorte", descrizione: "L'iconica torta al cioccolato e albicocca. Ottima per salutare Vienna.", indirizzi: "Aida (Catena Rosa, per un'opzione low-cost e diffusa) o Konditorei locale. Costo: ‚âà 4-7‚Ç¨ a fetta.", suggerito: "Giorno 4: 12:00 - Ultima Merenda/Colazione prima del transfer per l'aeroporto." },
                { titolo: "Mozartkugel / Manner Wafers", descrizione: "Le famose palle di cioccolato al pistacchio (Mozartkugel) e i wafer alla nocciola (Manner, prodotto a Vienna).", indirizzi: "Supermercati (Billa, Spar) o negozi Manner. Evita i negozi di souvenir troppo cari.", suggerito: "Giorno 4: 10:00 - Acquisto Souvenir / Snack." }
            ]
        };

        // Dati Culturali (Pianoviaggio Vienna v2 - Cultura.csv)
        const culturalMap = {
            "Hundertwasserhaus": { descrizione: "Non √® solo un edificio, √® un manifesto contro la 'dittatura della linea retta'! L'artista Friedensreich Hundertwasser, un ribelle del design, l'ha concepita come un'oasi ecologica e umana. Ogni inquilino aveva il diritto di dipingere la facciata intorno alla propria finestra a piacimento. √à un'esplosione di colori, alberi che spuntano dai balconi e pavimenti irregolari, un inno alla libert√† e all'armonia con la natura, lontano dalla seriosit√† imperiale.", curiosita: "Il Diritto della Finestra: Hundertwasser credeva che ogni persona avesse il diritto di 'disegnare' l'area della parete attorno alla propria finestra, fin dove arrivava il suo braccio. Il suo rifiuto dell'angolo retto era quasi filosofico, vedendolo come qualcosa di 'immorale' e innaturale." },
            "Castello del Belvedere": { descrizione: "Un capolavoro barocco commissionato dal Principe Eugenio di Savoia, un genio militare che sconfisse i Turchi. Non fu mai pensato come residenza principale, ma come 'giardino di delizie' e palazzo estivo, una celebrazione della sua gloria. Oggi, la sua Galleria Superiore custodisce il tesoro dell'Art Nouveau austriaco, con l'oro e l'erotismo dei capolavori di Gustav Klimt.", curiosita: "Il Giardino Segreto del Barocco: I giardini a terrazze, che collegano il Belvedere Superiore e Inferiore, sono un perfetto esempio di design barocco. Le sculture e le fontane creano un complesso simbolico che riflette l'ordine e la ragione dell'Illuminismo, in contrasto con la natura selvaggia." },
            "Duomo di Santo Stefano": { descrizione: "Conosciuta come Stephansdom, √® il cuore spirituale e geografico di Vienna. Le sue guglie gotiche dominano lo skyline. Il tetto piastrellato, con i suoi colori vivaci, √® un'opera d'arte unica. √à sopravvissuta a guerre e incendi, diventando un simbolo della resilienza e dell'identit√† austriaca.", curiosita: "La Porta del Gigante: La porta principale prende il nome dal femore di un mammut (o di un gigante, secondo la leggenda) appeso l√¨ per secoli. √à il luogo dove la leggenda e la storia si incontrano, proprio all'ingresso del Duomo." },
            "Hofburg Palace": { descrizione: "Per oltre 600 anni, questo √® stato il centro nevralgico dell'Impero Asburgico, la residenza invernale e il luogo dove si prendevano le decisioni che plasmavano l'Europa. √à un complesso di edifici che abbraccia stili dall'architettura gotica al neoclassicismo, testimoniando la continua crescita e il potere della dinastia.", curiosita: "Lo Stemma Nascosto di Sissi: Vicino agli appartamenti imperiali (Kaiserappartements), ci sono dettagli nascosti che riflettono la personalit√† ribelle di Elisabetta (Sissi), che odiava l'etichetta di corte. I suoi appartamenti erano un rifugio di privacy e malinconia, un contrasto con la grandiosit√† esterna." },
            "Rathausplatz": { descrizione: "La tradizione dei mercatini risale al Medioevo. Oggi √® il pi√π grande e spettacolare, con le luci che avvolgono il maestoso Municipio in un'atmosfera da fiaba.", curiosita: "Il Municipio Protettore: La facciata gotica del Municipio (Rathaus) √® stata progettata per sovrastare il potere imperiale di Hofburg. Durante il periodo natalizio, le luci sembrano trasformare l'architettura in un castello incantato, quasi come se proteggesse la gioia popolare dagli sguardi austeri dell'Impero." },
            "Castello di Sch√∂nbrunn": { descrizione: "La residenza estiva degli Asburgo e il luogo preferito di Sissi. Un capolavoro barocco da esplorare dal Grand Tour agli estesi giardini.", curiosita: "R√∂mische Ruine (Sch√∂nbrunn): Non sono affatto rovine romane autentiche! Furono costruite come un capriccio di Maria Teresa, un elemento scenografico romantico per il parco, che simulava un pezzo d'antichit√†, molto di moda nel Barocco." }
        };

        // Dati Budget (Mantenuti dalla versione precedente)
        const budgetData = [
            { categoria: "Alloggio (3 notti)", costo: 243.00, icon: 'bed' },
            { categoria: "Ingressi & Biglietti (Cultura)", costo: 132.00, icon: 'ticket' },
            { categoria: "Trasporti (Abbonamenti e Transfer)", costo: 69.40, icon: 'train' },
            { categoria: "Cibo & Bevande (Stimato per 4 giorni)", costo: 320.00, icon: 'sandwich' },
            { categoria: "Spese Varie & Souvenir", costo: 150.00, icon: 'shopping-bag' }
        ];

        let itineraryData = []; // Array finale popolato da initializeData

        // ===========================================
        // 2. LOGICA DI INIZIALIZZAZIONE E RENDERING
        // ===========================================
        
        function getIconNameByFocus(focus) {
            // Logica per determinare l'icona in base all'attivit√† (invariata)
            const activity = focus.toLowerCase();
            if (activity.includes('volo') || activity.includes('transfer') || activity.includes('bus')) return 'train';
            if (activity.includes('pranzo') || activity.includes('cena') || activity.includes('colazione') || activity.includes('cibo') || activity.includes('w√ºrstel')) return 'coffee';
            if (activity.includes('mercatino') || activity.includes('acquisti') || activity.includes('shopping')) return 'shopping-cart';
            if (activity.includes('castello') || activity.includes('hofburg') || activity.includes('sch√∂nbrunn') || activity.includes('duomo') || activity.includes('biblioteca') || activity.includes('chiesa')) return 'castle';
            if (activity.includes('belvedere') || activity.includes('museum') || activity.includes('arte')) return 'brush';
            if (activity.includes('hundertwasser')) return 'building-2';
            
            return 'circle-dot';
        }

        /**
         * Funzione per creare il link di Google Maps
         * @param {string} location La stringa del luogo da cercare su Google Maps.
         * @returns {string} Il tag <a> HTML per il link.
         */
        function createMapsLink(location) {
            // Utilizziamo i template literal (backtick `) per interpolare correttamente la variabile.
            const encodedLocation = encodeURIComponent(location.replace(/\s+/g, ' ').trim());
            // Link corretto a Google Maps per ottenere le indicazioni verso una destinazione.
            return `<a href="http://maps.google.com/maps?daddr=${encodedLocation}" target="_blank" class="text-blue-600 hover:text-blue-800 underline font-semibold">Ottieni indicazioni su Google Maps</a>`;
        }

        // Funzione per combinare i dati grezzi e arricchirli
        function initializeData() {
            itineraryData = rawItineraryData.map(item => {
                // 1. Estrai il numero del giorno e il nome completo
                const match = item.giorno.match(/Giorno (\d+)/);
                const giornoNumber = match ? parseInt(match[1]) : 0;
                
                // 2. Determina il focus
                const focus = getIconNameByFocus(item.attivita);
                
                // 3. Arricchisci i dettagli con le informazioni culturali
                let culturalInfo = '';
                
                const culturalKeys = Object.keys(culturalMap);
                for (const key of culturalKeys) {
                    // Controlla se l'attivit√† o il luogo contengono la chiave culturale
                    if (item.attivita.includes(key) || item.luogo.includes(key)) {
                        const cultData = culturalMap[key];
                        culturalInfo += `<p class="mt-3 font-semibold text-gray-800 border-t pt-2 border-gray-100">Contesto Storico (${key}):</p>`;
                        culturalInfo += `<p class="text-gray-700">${cultData.descrizione}</p>`;
                        culturalInfo += `<p class="italic text-gray-600 mt-1"><span class="accent-color">Curiosit√†:</span> ${cultData.curiosita}</p>`;
                        break; // Trovato il luogo, interrompi la ricerca
                    }
                }

                // 4. Genera il link di Google Maps
                const mapsLink = createMapsLink(item.luogo);
                const arrivalInfo = `
                    <p class="mt-3 font-semibold text-gray-800 border-t pt-2 border-gray-100">Come arrivare:</p>
                    <p class="text-gray-700">${mapsLink}</p>
                `;

                // 5. Combina tutti i dettagli in un unico campo
                const combinedDettagli = `
                    <p class="font-semibold text-gray-800"><span class="accent-color">Note Logistiche:</span> ${item.note}</p>
                    <p class="text-gray-700 mt-2"><span class="font-semibold">Contesto & Focus:</span> ${item.focus_raw}</p>
                    ${culturalInfo}
                    ${arrivalInfo} `;

                return {
                    giorno: giornoNumber,
                    ora: item.ora,
                    attivita: item.attivita,
                    luogo: item.luogo,
                    focus: focus,
                    note: item.note,
                    dettagli: combinedDettagli
                };
            });
        }

        window.toggleDetails = function(id) {
            const element = document.getElementById(id);
            const button = event.target;
            
            if (element.classList.contains('hidden')) {
                element.classList.remove('hidden');
                button.textContent = 'Nascondi Dettagli';
            } else {
                element.classList.add('hidden');
                button.textContent = 'Mostra Dettagli';
            }
        };

        const navButtons = document.querySelectorAll('.nav-button');
        const pages = document.querySelectorAll('.tab-content');
        
        window.showPage = function(pageId) {
            pages.forEach(page => { page.style.display = 'none'; });
            const targetPage = document.getElementById(pageId);
            if (targetPage) { targetPage.style.display = 'block'; }

            navButtons.forEach(button => { button.classList.remove('active-tab'); });
            const activeButton = document.querySelector(`button[data-page="${pageId}"]`);
            if (activeButton) { activeButton.classList.add('active-tab'); }
        }

        function renderTimeline(day, containerId) {
            const container = document.getElementById(containerId);
            const dailyData = itineraryData.filter(item => item.giorno === day);
            let htmlTimeline = '';

            dailyData.forEach((item, index) => {
                const iconName = item.focus; 
                const uniqueId = `${containerId}-details-${index}`;
                
                htmlTimeline += `
                    <div class="timeline-item relative py-4">
                        <div class="timeline-point absolute -left-0.5 top-6 w-3 h-3 rounded-full z-10"></div>
                        <div class="bg-white p-4 ml-4 rounded-lg shadow-md hover:shadow-xl transition duration-300 transform hover:scale-[1.01]">
                            <div class="flex items-start mb-2 justify-between">
                                <div class="flex items-center">
                                    <i data-lucide="${iconName}" class="w-5 h-5 mr-3 accent-color shrink-0"></i>
                                    <span class="font-bold text-lg accent-color">${item.attivita}</span>
                                </div>
                                 <span class="text-sm font-semibold text-gray-500">${item.ora}</span>
                            </div>
                            <p class="text-sm text-gray-700 mb-2 pl-8">üìç ${item.luogo}</p>
                            
                            <button 
                                class="details-btn text-xs font-semibold text-white py-1 px-3 rounded-full mt-2 no-print"
                                onclick="toggleDetails('${uniqueId}')"
                            >
                                Mostra Dettagli
                            </button>
                            <div id="${uniqueId}" class="hidden mt-3 pt-3 text-sm">
                                ${item.dettagli}
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = htmlTimeline;
            // lucide.createIcons() √® chiamato in DOMContentLoaded
        }

        function renderSummary() {
            const summaryContainer = document.getElementById('summary-container');
            let htmlSummary = '';
            let lastDay = 0;

            itineraryData.forEach(item => {
                if (item.giorno !== lastDay) {
                    htmlSummary += `
                        <h3 class="text-xl font-bold mt-6 pb-1 border-b-2 border-gray-300 accent-color">
                            Giorno ${item.giorno}
                        </h3>
                        <ul class="list-disc list-inside space-y-1 ml-4">
                    `;
                    lastDay = item.giorno;
                }
                
                htmlSummary += `
                    <li class="text-gray-700">
                        <span class="font-semibold">${item.ora}:</span> ${item.attivita} (<span class="italic">${item.luogo}</span>)
                    </li>
                `;

                if (itineraryData.length === itineraryData.indexOf(item) + 1 || itineraryData[itineraryData.indexOf(item) + 1].giorno !== lastDay) {
                    htmlSummary += `</ul>`;
                }
            });

            summaryContainer.innerHTML = htmlSummary;
        }

        function renderFoodShowcases() {
            const containerMap = {
                "Piatti tipici": "showcase-piatti",
                "Le merende reali": "showcase-merende",
                "Drink": "showcase-drink"
            };

            for (const category in newFoodData) {
                const id = containerMap[category];
                const container = document.getElementById(id);
                let htmlContent = '';

                newFoodData[category].forEach(item => {
                    htmlContent += `
                        <div class="bg-gray-50 p-3 rounded-lg mt-3 border border-gray-200">
                            <h4 class="font-bold text-lg">${item.titolo}</h4>
                            <p class="text-sm text-gray-700 mt-1">${item.descrizione}</p>
                            <p class="text-xs text-gray-500 mt-2 italic border-t pt-2">
                                üìç Dove: ${item.indirizzi}
                                <br>
                                üóìÔ∏è Suggerimento: ${item.suggerito}
                            </p>
                        </div>
                    `;
                });
                if (container) {
                     // Solo append, l'header h3 √® gi√† nell'HTML statico
                     container.innerHTML += htmlContent;
                }
            }
        }

        function renderBudgetAndStats() {
            const costs = budgetData.map(item => item.costo);
            const totalCost = costs.reduce((sum, cost) => sum + cost, 0);
            
            document.getElementById('total-budget-display').textContent = `‚Ç¨ ${totalCost.toFixed(2)}`;
            const kpiContainer = document.getElementById('kpi-summary');
            let htmlKpi = '';
            
            budgetData.forEach(item => {
                 htmlKpi += `
                    <div class="flex items-center">
                        <i data-lucide="${item.icon}" class="w-4 h-4 mr-2 text-gray-700"></i>
                        <span class="font-semibold">${item.categoria}:</span>
                        <span class="ml-auto font-bold">${item.costo.toFixed(2)} ‚Ç¨</span>
                    </div>
                `;
            });
            kpiContainer.innerHTML = htmlKpi;
            
            if (window.matchMedia('print').matches) return;

            const categories = budgetData.map(item => item.categoria.split('(')[0].trim());
            const imperialColors = ['#8C0000', '#C8AA50', '#A52A2A', '#D4AF37', '#B22222'];
            
            const ctx = document.getElementById('budgetChart').getContext('2d');
            
            // Distruggi e ricrea il grafico per evitare errori in caso di hot-reloading
            if (window.budgetChartInstance) {
                window.budgetChartInstance.destroy();
            }

            window.budgetChartInstance = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: categories,
                    datasets: [{
                        data: costs,
                        backgroundColor: imperialColors,
                        borderColor: 'white',
                        borderWidth: 2,
                        hoverOffset: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right' },
                        title: {
                            display: true,
                            text: `Costo Totale Stimato: ‚Ç¨ ${totalCost.toFixed(2)}`,
                            font: { size: 16, family: 'Georgia, serif' },
                            color: getComputedStyle(document.documentElement).getPropertyValue('--color-primary')
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) { label += ': '; }
                                    label += new Intl.NumberFormat('it-IT', { style: 'currency', currency: 'EUR' }).format(context.raw);
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            initializeData();
            renderSummary();
            renderTimeline(1, 'timeline-GIORNO1');
            renderTimeline(2, 'timeline-GIORNO2');
            renderTimeline(3, 'timeline-GIORNO3');
            renderTimeline(4, 'timeline-GIORNO4');
            renderFoodShowcases();
            renderBudgetAndStats();
            
            // CHIAMATA ESSENZIALE PER RENDERE TUTTE LE ICONE DOPO IL CARICAMENTO DEI DATI
            lucide.createIcons(); 
            
            // Mostra la pagina di default solo dopo che tutti i dati sono stati renderizzati
            showPage('page-PANORAMICA');
        });
    </script>
</body>
</html>
