<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vienna Imperiale - Guida Interattiva Modulare</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* DESIGN SYSTEM IMPERIALE */
        :root {
            --color-primary: #8C0000; /* Bordeaux Scuro (rich red) */
            --color-secondary: #C8AA50; /* Oro Antico (muted gold) */
            --color-background: #FAF8F4; /* Crema/Bianco Sporco */
            --color-text: #2c2c2c;
            --color-nav-bg: #4A4A4A; /* Grigio scuro per la navbar */
        }

        body {
            font-family: 'Georgia', serif;
            background-color: var(--color-background);
            color: var(--color-text);
        }

        /* HEADER & NAV BAR */
        .header-bg {
            background-color: var(--color-primary);
            color: white;
            border-bottom: 6px solid var(--color-secondary);
        }
        .nav-bg {
            background-color: var(--color-nav-bg); 
        }
        .nav-button {
            transition: all 0.2s;
            flex-shrink: 0; 
        }
        .nav-button:hover {
            background-color: #6C0000;
        }
        .active-tab { 
            background-color: var(--color-primary);
            font-weight: bold;
            border-bottom: 3px solid var(--color-secondary);
        }
        .intro-accent {
            color: var(--color-secondary); 
            font-weight: bold; 
        }

        /* VISUALIZZAZIONE TIMELINE */
        .accent-color { color: var(--color-primary); }
        .border-accent { border-color: var(--color-secondary); }
        .timeline-item { border-left: 2px solid var(--color-secondary); }
        .timeline-point {
            background-color: var(--color-primary);
            border: 4px solid var(--color-secondary);
        }
        .details-btn { background-color: var(--color-primary); }
        .details-btn:hover { background-color: #6C0000; }

        /* VETRINE CIBO */
        .food-showcase {
            background-color: white;
            border-top: 5px solid var(--color-primary);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        /* SEZIONI PAGINA */
        .tab-content {
            display: none; 
            min-height: 85vh; 
        }
        
        /* OTTIMIZZAZIONE PER LA STAMPA (PDF) */
        @media print {
            body { background-color: white !important; color: black !important; font-size: 10pt; }
            .fixed-element, .no-print { display: none !important; }
            .header-bg {
                background-color: white !important; color: black !important;
                border-bottom: 1px solid black !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .timeline-item { border-left: 1px dashed gray; }
            .timeline-point { background-color: white !important; border-color: black !important; }
            
            .tab-content { display: block !important; } 
            .hidden { display: block !important; } 
            
            #page-PANORAMICA, #page-GIORNO1, #page-GIORNO2, #page-GIORNO3, #page-GIORNO4, #page-CIBO, #page-BUDGET {
                 page-break-after: always; 
            }
            #page-BUDGET { page-break-after: avoid; }
        }
    </style>
</head>
<body>
    <header class="header-bg shadow-lg fixed top-0 w-full z-50 h-12 md:h-14 fixed-element">
        <div class="max-w-6xl mx-auto px-4 py-2 md:py-3">
            <h1 class="text-lg md:text-xl font-extrabold tracking-wider text-center pt-0.5">GUIDA VIENNA: L'EFFICACIA IMPERIALE</h1>
        </div>
    </header>

    <nav class="nav-bg fixed top-12 md:top-14 w-full z-40 shadow-xl h-10 fixed-element">
        <div class="max-w-6xl mx-auto px-4">
            <div class="flex overflow-x-auto whitespace-nowrap justify-start md:justify-center gap-1 text-sm md:text-base pt-1">
                <button onclick="showPage('page-PANORAMICA')" class="nav-button px-3 py-0.5 text-white" data-page="page-PANORAMICA">PANORAMICA</button>
                <button onclick="showPage('page-GIORNO1')" class="nav-button px-3 py-0.5 text-white" data-page="page-GIORNO1">GIORNO 1: VENERD√å 5</button>
                <button onclick="showPage('page-GIORNO2')" class="nav-button px-3 py-0.5 text-white" data-page="page-GIORNO2">GIORNO 2: SABATO 6</button>
                <button onclick="showPage('page-GIORNO3')" class="nav-button px-3 py-0.5 text-white" data-page="page-GIORNO3">GIORNO 3: DOMENICA 7</button>
                <button onclick="showPage('page-GIORNO4')" class="nav-button px-3 py-0.5 text-white" data-page="page-GIORNO4">GIORNO 4: LUNED√å 8</button>
                <button onclick="showPage('page-CIBO')" class="nav-button px-3 py-0.5 text-white" data-page="page-CIBO">CIBO</button>
                <button onclick="showPage('page-BUDGET')" class="nav-button px-3 py-0.5 text-white" data-page="page-BUDGET">BUDGET E STATISTICHE</button>
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto p-4 sm:p-6 lg:p-8 pt-[88px] md:pt-24">

        <section id="page-PANORAMICA" class="tab-content">
            <h2 class="text-3xl font-bold mb-6 pb-2 border-b border-accent accent-color flex items-center">
                <i data-lucide="scan" class="mr-2 text-2xl"></i> Panoramica Veloce: L'Essenza del Viaggio
            </h2>
            <div id="summary-container" class="space-y-6">
                <p class="text-lg italic text-gray-700">Caricamento itinerario sintetico...</p>
            </div>
        </section>

        <section id="page-GIORNO1" class="tab-content">
            <h2 class="text-3xl font-bold mb-8 pb-2 border-b border-accent accent-color flex items-center">
                <i data-lucide="calendar-check" class="mr-2 text-2xl"></i> Giorno 1: Venerd√¨ 5 - Arrivo, Arte & Concerto Fissato
            </h2>
            <p class="text-lg mb-6 bg-white p-4 rounded-lg shadow-md border-l-4 border-accent">
                <span class="intro-accent">Intro:</span> Il focus √® sull'arrivo a Vienna. Pranzo al **Caf√© Friedlich** con **prenotazione fissata alle 12:00** (max 1h 30m). La merenda con **Kaiserschmarrn** √® stata inserita prima del concerto.
            </p>
            <div id="timeline-GIORNO1" class="relative mt-4"></div>
        </section>

        <section id="page-GIORNO2" class="tab-content">
            <h2 class="text-3xl font-bold mb-8 pb-2 border-b border-accent accent-color flex items-center">
                <i data-lucide="calendar-check" class="mr-2 text-2xl"></i> Giorno 2: Sabato 6 - Impero, Libri, Sissi & Architettura
            </h2>
            <p class="text-lg mb-6 bg-white p-4 rounded-lg shadow-md border-l-4 border-accent">
                <span class="intro-accent">Intro:</span> Giorno dedicato alle residenze imperiali (Sch√∂nbrunn e Hofburg), al mercato eclettico (Naschmarkt) e al relax in un caff√® storico. La sera √® prevista una **Cena Tradizionale** (che sostituisce il Kaiserschmarrn ora spostato a Giorno 1).
            </p>
            <div id="timeline-GIORNO2" class="relative mt-4"></div>
        </section>
        
        <section id="page-GIORNO3" class="tab-content">
            <h2 class="text-3xl font-bold mb-8 pb-2 border-b border-accent accent-color flex items-center">
                <i data-lucide="calendar-check" class="mr-2 text-2xl"></i> Giorno 3: Domenica 7 - Ottimizzazione Geografica: Nord/Est e Blocco Culturale
            </h2>
            <p class="text-lg mb-6 bg-white p-4 rounded-lg shadow-md border-l-4 border-accent">
                <span class="intro-accent">Intro:</span> L'obiettivo √® minimizzare gli spostamenti: iniziamo con **Donauturm** e **Prater** (vicino all'hotel), proseguiamo per il cruciale **Paternoster** (3¬∞ distretto), e concludiamo con la magia serale di **Rathausplatz** nel cuore della citt√†.
            </p>
            <div id="timeline-GIORNO3" class="relative mt-4"></div>
        </section>

        <section id="page-GIORNO4" class="tab-content">
            <h2 class="text-3xl font-bold mb-8 pb-2 border-b border-accent accent-color flex items-center">
                <i data-lucide="calendar-check" class="mr-2 text-2xl"></i> Giorno 4: Luned√¨ 8 - Cultura Finale, Acquisti e Partenza
            </h2>
            <p class="text-lg mb-6 bg-white p-4 rounded-lg shadow-md border-l-4 border-accent">
                <span class="intro-accent">Intro:</span> La mattina √® dedicata al **Wien Museum** (spostato qui per ottimizzare il percorso), che √® logisticamente vicino a Karlsplatz, un ottimo punto di partenza per il transfer in aeroporto. Acquisti finali e partenza.
            </p>
            <div id="timeline-GIORNO4" class="relative mt-4"></div>
        </section>

        <section id="page-CIBO" class="tab-content">
            <h2 class="text-3xl font-bold mb-8 pb-2 border-b border-accent accent-color flex items-center">
                <i data-lucide="utensils" class="mr-2 text-2xl"></i> Delizie Culinarie di Vienna
            </h2>
            <div id="food-showcases" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div id="showcase-piatti" class="food-showcase p-5 rounded-xl">
                    <h3 class="text-2xl font-bold accent-color mb-4">üçΩÔ∏è Piatti Tipici (Pranzi & Cene)</h3>
                </div>
                <div id="showcase-merende" class="food-showcase p-5 rounded-xl">
                    <h3 class="text-2xl font-bold accent-color mb-4">üç∞ Le Merende Reali (Dolci & Caf√©)</h3>
                </div>
                <div id="showcase-drink" class="food-showcase p-5 rounded-xl">
                    <h3 class="text-2xl font-bold accent-color mb-4">‚òï Drink (Caldi & Mercatino)</h3>
                </div>
            </div>
        </section>

        <section id="page-BUDGET" class="tab-content">
            <h2 class="text-3xl font-bold mb-8 pb-2 border-b border-accent accent-color flex items-center">
                <i data-lucide="wallet" class="mr-2 text-2xl"></i> Analisi Budget e Statistiche
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="md:col-span-1 bg-white p-6 rounded-xl shadow-xl border-l-4 border-accent">
                    <h3 class="text-xl font-bold accent-color mb-4">Riepilogo Totale</h3>
                    <p class="text-4xl font-extrabold" id="total-budget-display">‚Ç¨ XXX.XX</p>
                    <p class="text-sm mt-2 text-gray-600">Costo stimato per persona (esclusi voli).</p>
                    <div id="kpi-summary" class="mt-6 space-y-3 text-sm">
                    </div>
                </div>

                <div class="md:col-span-2 bg-white p-6 rounded-xl shadow-xl border-l-4 border-accent no-print">
                    <h3 class="text-xl font-bold accent-color mb-4">Ripartizione Costi (Grafico)</h3>
                    <div class="chart-container" style="height: 350px;">
                        <canvas id="budgetChart"></canvas>
                    </div>
                    <p class="text-center text-sm mt-4 italic text-gray-500">I costi sono stimati e arrotondati.</p>
                </div>
            </div>
        </section>

    </main>

    <script>
        // ===========================================
        // 1. DATI (Ricavati dai file CSV aggiornati dall'utente)
        // ===========================================
        
        // Dati Itinerario (AGGIORNATO CON L'ULTIMA RICHIESTA)
        const rawItineraryData = [
            { giorno: "Giorno 1: Ven 5 - Arrivo, Arte & Concerto Fissato", ora: "04:00", attivita: "Bus Torino $\\rightarrow$ Malpensa", luogo: "Torino", note: "Logistica: Prenota il bus in anticipo.", focus_raw: "Trasferimento iniziale. Viaggio lungo per l'opzione pi√π economica. | Sveglia all'alba!" },
            { giorno: "Giorno 1", ora: "09:00 - 10:30", attivita: "Volo MXP $\\rightarrow$ VIE", luogo: "MXP / VIE", note: "", focus_raw: "Volo diretto Milano Malpensa $\\rightarrow$ Vienna-Schwechat." },
            { giorno: "Giorno 1", ora: "11:00", attivita: "Trasferimento Aeroporto $\\rightarrow$ Praterstern", luogo: "Flughafen Wien", note: "S-Bahn S7 per Wien Praterstern. Acquista: Pass 72h + supplemento aeroporto $2‚Ç¨$.", focus_raw: "La linea S7 √® la pi√π economica per il centro. | Base: Hotel in Leopoldstadt (1020), vicino Praterstern." },
            
            // ATTIVIT√Ä GIORNO 1
            { giorno: "Giorno 1", ora: "11:40", attivita: "Trasferimento al KunstHausWien (Bagagli al seguito)", luogo: "Praterstern ‚Üí KunstHausWien", note: "Logistica: Raggiungi la zona Hundertwasser (Bus 80A o Tram 1). I bagagli (Deluxe Living Hotel) vanno portati con s√© fino al check-in alle 15:00.", focus_raw: "FOCUS LOGISTICO: Mantenere i bagagli con s√©. Arrivo in zona per il pranzo prenotato." },
            { giorno: "Giorno 1", ora: "12:00 - 13:30", attivita: "Pranzo al Caf√© Friedlich (Prenotato: Max 1h 30m)", luogo: "Caf√© Friedlich im KunstHausWien Museum Hundertwasser, 1030 Wien", note: "Pausa pranzo veloce. **Prenotazione Fissata alle 12:00.** Essere pronti a ripartire alle 13:30.", focus_raw: "FOCUS LOGISTICO: Pranzo rapido in ambiente Hundertwasser. | FOCUS CULINARIO: Insalate, opzioni bio, o un Melange." },
            { giorno: "Giorno 1", ora: "13:30", attivita: "Hundertwasserhaus & Village", luogo: "Hundertwasser Village", note: "Logistica: A piedi. Visita esterna. Tempo limitato (1 ora).", focus_raw: "Manifesto contro la \"dittatura della linea retta\" e architettura ecologica dell'artista Hundertwasser. | FOCUS FOTO: Architettura surreale e colori vivaci." },
            { giorno: "Giorno 1", ora: "14:30", attivita: "Trasferimento & Check-in (ufficiale)", luogo: "Deluxe Living Hotel (Leopoldstadt)", note: "Logistica Cruciale: Rilasciare i bagagli in camera. L'orario di check-in ufficiale √® alle 15:00.", focus_raw: "Ritorno al Deluxe Living Hotel per la formalit√†. Finalmente alleggerirsi prima delle visite pomeridiane." },
            { giorno: "Giorno 1", ora: "15:00", attivita: "Belvedere Superiore (Klimt)", luogo: "Schloss Belvedere", note: "Tram O da Praterstern a Schloss Belvedere ($\\approx 15$ min). Costo: $24‚Ç¨$. Durata: 1h 40m MAX.", focus_raw: "Capolavoro barocco del Principe Eugenio, casa de \"Il Bacio\". | FOCUS ARTE: Assolutamente da non perdere \"Il Bacio\"." },
            { giorno: "Giorno 1", ora: "16:40", attivita: "Chiesa dei Gesuiti (Universit√†)", luogo: "Universit√§tsplatz", note: "Logistica: Tram D da Belvedere + breve passeggiata. Ingresso Gratuito. Durata: 50 minuti.", focus_raw: "Capolavoro del Barocco. Affreschi illusionistici di Andrea Pozzo. | FOCUS FOTO: Interni sfarzosi in un ambiente caldo (cerca il punto di visuale perfetto)." },
            { giorno: "Giorno 1", ora: "17:30 - 18:30", attivita: "Mercatino Stephansplatz & Duomo", luogo: "Stephansplatz", note: "Consiglio: Primo Gl√ºhwein per scaldarsi. Tempo ridotto per la merenda.", focus_raw: "Esplorazione veloce della Cattedrale gotica (esterno) e l'atmosfera natalizia. | FOCUS FOTO: La cattedrale illuminata al crepuscolo." },
            { giorno: "Giorno 1", ora: "18:30 - 19:00", attivita: "Merenda al Kaiser's ‚Äì Kaiser'schmarrn (Take-Away)", luogo: "Sede centrale in zona 1 (es. Opernring/Schwedenplatz)", note: "Pausa dolce veloce e low-cost. Essendo da asporto, il tempo √® limitato a 30 minuti, proprio prima del concerto.", focus_raw: "Pancake dell'Imperatore. Essendo da asporto, si risparmia tempo e si soddisfa la voglia di dolce come merenda. | FOCUS CULINARIO: Dolce take-away." },
            { giorno: "Giorno 1", ora: "19:00 - 20:00", attivita: "B√∂sendorfer Salonkonzert", luogo: "B√∂sendorfer Salon", note: "Logistica: A piedi dal centro storico.", focus_raw: "Concerto di musica classica (Sergey Tanin). | EVENTO FISSATO!" },
            { giorno: "Giorno 1", ora: "20:30", attivita: "Cena Post-Concerto", luogo: "Zum Friedensrichter", note: "Zum Friedensrichter (zona 2, per budget) o Beisl in zona Graben. Schnitzel di maiale.", focus_raw: "Cena in un Beisl per una Schnitzel gigante e low-cost. | FOCUS CULINARIO: Autenticit√† e risparmio." },
            
            // Dati Giorno 2
            { giorno: "Giorno 2: Sab 6 - Impero, Libri, Sissi & Architettura", ora: "09:00", attivita: "Palazzo di Sch√∂nbrunn (Imperial Tour)", luogo: "Sch√∂nbrunn Palace, 1130 Wien", note: "Metro U4 da Praterstern (con cambio U3) a Sch√∂nbrunn. Costo: $22‚Ç¨$ (Tour Veloce).", focus_raw: "Residenza estiva degli Asburgo. Visita interna rapida. | FOCUS STORICO: Vita di Sissi e Francesco Giuseppe." },
            { giorno: "Giorno 2", ora: "11:30", attivita: "Giardini & R√∂mische Ruine", luogo: "Sch√∂nbrunn Gardens", note: "Logistica: A piedi. Ingresso Gratuito.", focus_raw: "Passeggiata nei giardini barocchi. Le finte rovine, capriccio di Maria Teresa. | CURIOISIT√Ä: La R√∂mische Ruine √® un simbolo di caducit√†." },
            { giorno: "Giorno 2", ora: "12:30", attivita: "Pranzo al Naschmarkt", luogo: "Naschmarkt, 1060 Wien", note: "Metro U4 da Sch√∂nbrunn a Kettenbr√ºckengasse. Costo: $\\approx 10-15‚Ç¨$ a persona.", focus_raw: "Il mercato pi√π grande di Vienna. Street food internazionale e locale. | FOCUS CULINARIO: Cibo caldo e vario al mercato." },
            { giorno: "Giorno 2", ora: "14:00", attivita: "Hofburg: Tesoro & Sissi Museum", luogo: "Hofburg, 1010 Wien", note: "Logistica: A piedi da Naschmarkt. Costo: $\\approx 25‚Ç¨$ (Biglietto Combinato).", focus_raw: "Palazzo d'Inverno. Corona del Sacro Romano Impero e storia intima di Sissi. | CURIOISIT√Ä: Vedere la Sacra Lancia (Heilige Lanze)." },
            { giorno: "Giorno 2", ora: "16:30", attivita: "Biblioteca Nazionale (Sala di Stato)", luogo: "Hofburg, 1010 Wien", note: "Logistica: 5 min a piedi da Hofburg. Costo: $10‚Ç¨$.", focus_raw: "La sala barocca pi√π bella del mondo, voluta da Carlo VI. | FOCUS FOTO: L'atmosfera sacra del sapere." },
            { giorno: "Giorno 2", ora: "17:30", attivita: "Caf√© Central (Pausa Calda)", luogo: "Caf√© Central, 1010 Wien", note: "Consiglio Budget: Ordina solo una bevanda calda e goditi l'ambiente.", focus_raw: "L'elegante tempio della cultura dei caff√®, frequentato da figure storiche. | FOCUS LOGISTICO: Break al caldo e in un ambiente storico." },
            { giorno: "Giorno 2", ora: "19:00", attivita: "Passeggiata Architettonica", luogo: "1¬∞ Distretto (Centro)", note: "Logistica: A piedi nel 1¬∞ distretto. Ingresso Gratuito.", focus_raw: "Tour fotografico esterno: Ferstel Passage, Palazzo Kinsky, Palazzo Liechtenstein, Equitable Palace. | FOCUS FOTO: Dettagli degli edifici e passaggi eleganti." },
            { giorno: "Giorno 2", ora: "20:30", attivita: "Cena Tradizionale (Autentica)", luogo: "Beisl in zona 1 o 7/8", note: "Cena tradizionale con piatti caldi (Gulaschsuppe o Kn√∂del), ora che il Kaiserschmarrn √® stato spostato.", focus_raw: "Cena in un Beisl con piatti tipici austriaci. | FOCUS CULINARIO: Autenticit√† e budget." }, 

            // Dati Giorno 3 (RIORGANIZZATO PER EFFICIENZA GEOGRAFICA)
            { giorno: "Giorno 3: Dom 7 - Nord/Est (Danubio) e Paternoster", ora: "09:00", attivita: "Trasferimento & Donauturm", luogo: "Donauturm, 1220 Wien", note: "Inizia con il punto pi√π lontano. Logistica: Metro U1 (da Praterstern) per Donauinsel/Kaiserm√ºhlen, poi Bus 11A. Costo: $18‚Ç¨$ (salita Torre).", focus_raw: "FOCUS VISTA: Sfrutta la luce mattutina per le foto panoramiche dalla torre (360¬∞ sulla citt√†)." },
            { giorno: "Giorno 3", ora: "10:30", attivita: "Kaiserm√ºhlenbucht & Relax", luogo: "Alte Donau", note: "Logistica: A piedi o breve bus dal Donauturm. Ingresso Gratuito.", focus_raw: "La tranquilla baia del Vecchio Danubio. FOCUS RELAX: Pausa in riva al fiume, lontano dal centro." },
            { giorno: "Giorno 3", ora: "11:45", attivita: "Prater & Ruota Panoramica", luogo: "Wurstelprater, 1020 Wien", note: "Logistica: Metro U1 per Praterstern (vicino all'hotel). Ingresso gratuito al parco.", focus_raw: "Il pi√π antico parco divertimenti del mondo. FOCUS DIVERTIMENTO: Atmosfera vintage e fotografica." },
            { giorno: "Giorno 3", ora: "13:15", attivita: "Pranzo Veloce in Zona Prater/Hotel", luogo: "W√ºrstelstand o Imbiss (Leopoldstadt)", note: "Pranzo low-cost rapido in zona hotel prima di riprendere la metro per la zona sud.", focus_raw: "FOCUS CULINARIO: Ricarica prima del blocco pomeridiano." },
            { giorno: "Giorno 3", ora: "14:30", attivita: "House of Industry (Paternoster)", luogo: "Schwarzenbergplatz, 1030 Wien", note: "La tappa cruciale! Logistica: Tram D da Praterstern a Schwarzenbergplatz (3¬∞ distretto). Ingresso Paternoster gratuito.", focus_raw: "FOCUS FOTO: L'esperienza e le foto sull'ascensore storico a ciclo continuo." },
            { giorno: "Giorno 3", ora: "15:45", attivita: "Passeggiata Sud e Mercatini Secondari", luogo: "Karlsplatz / Naschmarkt", note: "Esplorazione della zona di Karlsplatz/Naschmarkt e mercatino alternativo (es. Karlsplatz Art Advent).", focus_raw: "FOCUS FOTO: Architettura e mercatini artistici." },
            { giorno: "Giorno 3", ora: "17:30", attivita: "Mercatino Rathausplatz (Illuminazione)", luogo: "Rathausplatz, 1010 Wien", note: "Logistica: Tram o Metro per Rathaus.", focus_raw: "Il grande evento serale! FOCUS SERALE: Il Municipio illuminato e l'atmosfera natalizia." },
            { giorno: "Giorno 3", ora: "19:30", attivita: "Passeggiata Architettonica Serale (Completa)", luogo: "Centro Storico (Graben, K√§rntner Stra√üe)", note: "Completa le tappe fotografiche del centro che non hai visto bene il Giorno 2 sera.", focus_raw: "FOCUS FOTO: Architettura illuminata e vie centrali (Ferstel Passage, Equitable, Palazzo Kinsky)." },
            { giorno: "Giorno 3", ora: "20:30", attivita: "Cena di Arrivederci (Tipica)", luogo: "Beisl in zona 7/8 o vicino all'hotel", note: "Ultima cena salata e tradizionale. (Gulaschsuppe o Kn√∂del).", focus_raw: "FOCUS CULINARIO: Piatti caldi e confortevoli." },

            // Dati Giorno 4 (RIORGANIZZATO PER CULTURA E PARTENZA)
            { giorno: "Giorno 4: Lun 8 - Cultura, Acquisti e Partenza", ora: "09:00", attivita: "Colazione e Ultimo T√®", luogo: "Hotel/Konditorei", note: "Colazione tranquilla e preparazione degli zaini. Consiglio: Ultima Sachertorte o Apfelstrudel.", focus_raw: "Ultima colazione viennese." },
            { giorno: "Giorno 4", ora: "10:00", attivita: "Wien Museum Karlsplatz (Tappa mancante)", luogo: "Wien Museum Karlsplatz", note: "Logistica: Metro U4/U1 per Karlsplatz (4¬∞ distretto). Costo: $\\approx 12‚Ç¨$. Ottimo per l'aeroporto.", focus_raw: "FOCUS CULTURALE: Storia civica di Vienna. L'ultimo museo richiesto." },
            { giorno: "Giorno 4", ora: "11:30", attivita: "Acquisto Souvenir e Check-out", luogo: "Karlsplatz / Rientro Hotel", note: "Ultimi acquisti. Acquista Mozartkugel/Manner Wafers nei supermercati.", focus_raw: "Logistica: Rientro in hotel per il check-out (12:00)." },
            { giorno: "Giorno 4", ora: "13:00", attivita: "Pranzo Veloce & Trasferimento Aeroporto", luogo: "Hotel $\\rightarrow$ Aeroporto", note: "Pranzo rapido prima di dirigersi verso la S7. Logistica: S7 da Wien Praterstern $\\rightarrow$ Flughafen Wien. Costo: $2‚Ç¨$ supplemento.", focus_raw: "Partenza da Vienna ore 16:35. Lasciarsi largo anticipo." },
            { giorno: "Giorno 4", ora: "16:35 - 18:05", attivita: "Volo VIE $\\rightarrow$ MXP", luogo: "VIE / MXP", note: "", focus_raw: "Volo di ritorno per Malpensa." },
            { giorno: "Giorno 4", ora: "19:00", attivita: "Bus Malpensa $\\rightarrow$ Torino", luogo: "MXP $\\rightarrow$ Torino", note: "", focus_raw: "Trasferimento finale in bus. | Fine del viaggio." }
        ];

        // Dati Cibo (Mantenuti e verificati per coerenza con Giorno 1/2)
        const newFoodData = {
            "Piatti tipici": [
                { 
                    titolo: "Caf√© Friedlich (KunstHausWien)", 
                    descrizione: "Pranzo veloce in un ambiente unico che riflette la filosofia anti-convenzionale di Hundertwasser. Il locale √® luminoso, colorato e offre opzioni leggere, bio e fresche, dalle zuppe alle insalate o un piatto del giorno. Un'ottima immersione iniziale nell'arte.", 
                    indirizzi: "KunstHausWien Museum (terzo distretto). Prenotazione fissata alle 12:00. Costo: $\\approx 12-18‚Ç¨$.", 
                    suggerito: "Giorno 1: 12:00 - Pranzo di Arrivo (Max 1h 30m)." 
                },
                
                { titolo: "K√§sekrainer / W√ºrstel", descrizione: "Il re dello street food viennese. Salsiccia di maiale affumicata ripiena di formaggio fuso. Veloce, caldo e low-cost.", indirizzi: "Bitzinger W√ºrstelstand (vicino Praterstern). Perfetto per uno spuntino. Costo: $\\approx 5-6‚Ç¨$.", suggerito: "Alternativa low-cost a pranzo/cena: Giorno 3, 13:15 - Pranzo Veloce in zona Prater." },
                
                { titolo: "Wiener Schnitzel", descrizione: "La celebre cotoletta viennese. Scegli quella di maiale (Schwein) nei Beisl per risparmiare rispetto a quella di vitello (Kalb).", indirizzi: "Beisl Tradizionale / Zum Friedensrichter (Leopoldstadt) per un'opzione vicina e autentica. Costo: $12 - $18 (maiale).", suggerito: "Giorno 1: 20:30 - Cena Post-Concerto." },
                { titolo: "Gulasch", descrizione: "Stufato di manzo in salsa di paprika. Perfetto per riscaldarsi.", indirizzi: "Beisl autentico o ristorante come Anzengruber. Costo: $15 - $22.", suggerito: "Giorno 2: 20:30 - Cena Tradizionale (come pasto caldo e tradizionale)." },
                { titolo: "Tafelspitz", descrizione: "Bollito di manzo in brodo con contorni. Piatto preferito di Franz Joseph.", indirizzi: "Ristoranti tradizionali di alta qualit√† (es. Plachutta). Costo: $25 - $35$.", suggerito: "Giorno 3: 20:30 - Cena di Arrivederci (come alternativa pi√π elegante)." }
            ],
            "Drink": [
                { titolo: "Gl√ºhwein / Punsch", descrizione: "Vino caldo e speziato o punch (spesso con brandy o rum). Indispensabile per affrontare i mercatini. Ideale per riscaldarsi. Costo: $8 - $14.", indirizzi: "Mercatini di Natale (qualsiasi chiosco).", suggerito: "Giorno 3: 17:30 - Pausa Calda al Mercatino di Rathausplatz." }
            ],
            "Le merende reali": [
                { titolo: "Kaiserschmarrn (Merenda Take-Away)", descrizione: "Il famoso 'pancake dell'Imperatore'. Molto **sostanzioso**, quindi √® perfetto come merenda che spezza la fame prima di un evento serale. Consigliato prenderlo in formato piccolo da asporto per non appesantirsi troppo prima del concerto.", indirizzi: "**Kaiser's ‚Äì Kaiser'schmarrn** (specializzato, sede in zona 1). Costo: $\\approx 8-12‚Ç¨$ (per una porzione ridotta/take-away).", suggerito: "**Giorno 1: 18:30 - Merenda Veloce (prima del concerto).**" },

                { titolo: "Pausa Caf√©/Atmosfera", descrizione: "Non un piatto, ma l'esperienza essenziale del caff√® viennese in un ambiente storico.", indirizzi: "Caf√© Central (Interni maestosi, low-cost se si ordina solo una bevanda). Costo: $\\approx 5‚Ç¨$ per un Melange.", suggerito: "Giorno 2: 17:30 - Pausa Calda (dopo la Biblioteca Nazionale)." },
                { titolo: "Apfelstrudel", descrizione: "Sfoglia sottile ripiena di mele, uvetta e cannella, servita calda (spesso con salsa alla vaniglia).", indirizzi: "Mercatini di Natale o qualsiasi Konditorei (pasticceria).", suggerito: "Giorno 4: 09:00 - Colazione/Merenda finale." },
                { titolo: "Sachertorte", descrizione: "L'iconica torta al cioccolato e albicocca. Ottima per salutare Vienna.", indirizzi: "Aida (Catena Rosa, per un'opzione low-cost e diffusa) o Konditorei locale. Costo: $\\approx 4-7‚Ç¨$ a fetta.", suggerito: "Giorno 4: 09:00 - Colazione/Merenda finale." },
                { titolo: "Mozartkugel / Manner Wafers", descrizione: "Le famose palle di cioccolato al pistacchio (Mozartkugel) e i wafer alla nocciola (Manner, prodotto a Vienna).", indirizzi: "Supermercati (Billa, Spar) o negozi Manner. Evita i negozi di souvenir troppo cari.", suggerito: "Giorno 4: 11:30 - Acquisto Souvenir / Snack." }
            ]
        };

        // Dati Culturali (Il Furniture Museum non √® pi√π richiesto, ma il Wien Museum e Paternoster sono confermati)
        const culturalMap = {
            "Hundertwasserhaus": { descrizione: "Non √® solo un edificio, √® un manifesto contro la 'dittatura della linea retta'! L'artista Friedensreich Hundertwasser, un ribelle del design, l'ha concepita come un'oasi ecologica e umana. **Il Caf√© Friedlich** adiacente estende questa filosofia, offrendo un'atmosfera colorata e organica per la tua pausa pranzo.", curiosita: "Il Diritto della Finestra: Hundertwasser credeva che ogni persona avesse il diritto di 'disegnare' l'area della parete attorno alla propria finestra, fin dove arrivava il suo braccio. Il suo rifiuto dell'angolo retto era quasi filosofico." },
            "Castello del Belvedere": { descrizione: "Un capolavoro barocco commissionato dal Principe Eugenio di Savoia, un genio militare. Oggi, la sua Galleria Superiore custodisce il tesoro dell'Art Nouveau austriaco, con l'oro e l'erotismo dei capolavori di Gustav Klimt.", curiosita: "Il Giardino Segreto del Barocco: I giardini a terrazze, che collegano il Belvedere Superiore e Inferiore, sono un perfetto esempio di design barocco che riflette l'ordine e la ragione dell'Illuminismo." },
            "Duomo di Santo Stefano": { descrizione: "Conosciuta come Stephansdom, √® il cuore spirituale e geografico di Vienna. Le guglie gotiche dominano lo skyline. Il tetto piastrellato √® un'opera d'arte unica e un simbolo della resilienza austriaca.", curiosita: "La Porta del Gigante: La porta principale prende il nome dal femore di un mammut (o di un gigante, secondo la leggenda) appeso l√¨ per secoli." },
            "Hofburg Palace": { descrizione: "Per oltre 600 anni, questo √® stato il centro nevralgico dell'Impero Asburgico, la residenza invernale. Un complesso che abbraccia stili dall'architettura gotica al neoclassicismo.", curiosita: "Lo Stemma Nascosto di Sissi: Vicino agli appartamenti imperiali (Kaiserappartements), ci sono dettagli nascosti che riflettono la personalit√† ribelle di Elisabetta (Sissi), che odiava l'etichetta di corte." },
            "Rathausplatz": { descrizione: "La tradizione dei mercatini risale al Medioevo. Oggi √® il pi√π grande e spettacolare, con le luci che avvolgono il maestoso Municipio in un'atmosfera da fiaba.", curiosita: "Il Municipio Protettore: La facciata gotica del Municipio (Rathaus) √® stata progettata per sovrastare il potere imperiale di Hofburg." },
            "Castello di Sch√∂nbrunn": { descrizione: "La residenza estiva degli Asburgo e il luogo preferito di Sissi. Un capolavoro barocco da esplorare dal Grand Tour agli estesi giardini.", curiosita: "R√∂mische Ruine (Sch√∂nbrunn): Non sono affatto rovine romane autentiche! Furono costruite come un capriccio di Maria Teresa, un elemento scenografico romantico per il parco, che simulava un pezzo d'antichit√†, molto di moda nel Barocco." },
            "Paternoster": { descrizione: "Un tipo di ascensore insolito e antico, a ciclo continuo, presente in alcuni edifici storici. Offre un'esperienza di viaggio unica, quasi meccanica, in un ambiente opulento.", curiosita: "House of Industry: L'edificio √® un bellissimo esempio di architettura tardo-storica viennese ed √® rinomato per aver conservato il suo Paternoster, che in molti luoghi √® stato dismesso per motivi di sicurezza." },
            "Wien Museum Karlsplatz": { descrizione: "Il Museo Storico di Vienna. Riunisce la storia della citt√† dal Medioevo alla modernit√†, dalle armature dei principi ai dipinti di Klimt. Riaperto di recente in un edificio rinnovato, √® un punto di riferimento per capire l'anima di Vienna.", curiosita: "Il Tetto Segreto: Il nuovo edificio del museo √® stato progettato per integrare il vecchio. Una parte del tetto √® spesso accessibile e offre un punto panoramico insolito sulla Karlsplatz." }
        };

        // Dati Budget (Mantenuti dalla versione precedente)
        const budgetData = [
            { categoria: "Alloggio (3 notti)", costo: 243.00, icon: 'bed' },
            { categoria: "Ingressi & Biglietti (Cultura)", costo: 132.00, icon: 'ticket' },
            { categoria: "Trasporti (Abbonamenti e Transfer)", costo: 69.40, icon: 'train' },
            { categoria: "Cibo & Bevande (Stimato per 4 giorni)", costo: 320.00, icon: 'sandwich' },
            { categoria: "Spese Varie & Souvenir", costo: 150.00, icon: 'shopping-bag' }
        ];

        let itineraryData = []; // Array finale popolato da initializeData

        // ===========================================
        // 2. LOGICA DI INIZIALIZZAZIONE E RENDERING
        // ===========================================
        
        function getIconNameByFocus(focus) {
            const activity = focus.toLowerCase();
            if (activity.includes('volo') || activity.includes('transfer') || activity.includes('bus')) return 'train';
            if (activity.includes('pranzo') || activity.includes('cena') || activity.includes('colazione') || activity.includes('cibo') || activity.includes('w√ºrstel') || activity.includes('caf√©') || activity.includes('kaiserschmarrn')) return 'coffee';
            if (activity.includes('mercatino') || activity.includes('shopping') || activity.includes('souvenir')) return 'shopping-cart';
            if (activity.includes('castello') || activity.includes('hofburg') || activity.includes('sch√∂nbrunn') || activity.includes('biblioteca') || activity.includes('tesoro')) return 'castle';
            if (activity.includes('belvedere') || activity.includes('museum') || activity.includes('arte') || activity.includes('concerto')) return 'brush';
            if (activity.includes('hundertwasser') || activity.includes('architettonica') || activity.includes('paternoster') || activity.includes('industry')) return 'building-2';
            if (activity.includes('prater') || activity.includes('divertimento')) return 'roller-coaster';
            if (activity.includes('donauturm') || activity.includes('baia')) return 'tower';
            
            return 'circle-dot';
        }

        /**
         * Funzione per creare il link di Google Maps
         * @param {string} location La stringa del luogo da cercare su Google Maps.
         * @returns {string} Il tag <a> HTML per il link.
         */
        function createMapsLink(location) {
            // Sintassi template literal e encodeURIComponent corrette
            const encodedLocation = encodeURIComponent(location.replace(/\s+/g, ' ').trim());
            return `<a href="https://maps.google.com/?q=${encodedLocation}" target="_blank" class="text-blue-600 hover:text-blue-800 underline font-semibold">Ottieni indicazioni su Google Maps</a>`;
        }

        // Funzione per combinare i dati grezzi e arricchirli
        function initializeData() {
            itineraryData = rawItineraryData.map(item => {
                // 1. Estrai il numero del giorno e il nome completo
                const match = item.giorno.match(/Giorno (\d+)/);
                const giornoNumber = match ? parseInt(match[1]) : 0;
                
                // 2. Determina il focus
                const focus = getIconNameByFocus(item.attivita + item.focus_raw);
                
                // 3. Arricchisci i dettagli con le informazioni culturali
                let culturalInfo = '';
                
                const culturalKeys = Object.keys(culturalMap);
                for (const key of culturalKeys) {
                    // Controlla se l'attivit√† o il luogo contengono la chiave culturale
                    if (item.attivita.includes(key) || item.luogo.includes(key) || item.attivita.includes("Paternoster") && key.includes("Paternoster") || item.attivita.includes("Caf√© Friedlich") && key.includes("Hundertwasserhaus") || item.luogo.includes("Wien Museum") && key.includes("Wien Museum")) {
                        const cultData = culturalMap[key];
                        culturalInfo += `<p class="mt-3 font-semibold text-gray-800 border-t pt-2 border-gray-100">Contesto Storico (${key}):</p>`;
                        culturalInfo += `<p class="text-gray-700">${cultData.descrizione}</p>`;
                        culturalInfo += `<p class="italic text-gray-600 mt-1"><span class="accent-color">Curiosit√†:</span> ${cultData.curiosita}</p>`;
                        break; // Trovato il luogo, interrompi la ricerca
                    }
                }

                // 4. Genera il link di Google Maps
                const mapsLink = createMapsLink(item.luogo);
                const arrivalInfo = `
                    <p class="mt-3 font-semibold text-gray-800 border-t pt-2 border-gray-100">Come arrivare:</p>
                    <p class="text-gray-700">${mapsLink}</p>
                `;

                // 5. Combina tutti i dettagli in un unico campo
                const combinedDettagli = `
                    <p class="font-semibold text-gray-800"><span class="accent-color">Note Logistiche:</span> ${item.note || 'Nessuna nota logistica.'}</p>
                    <p class="text-gray-700 mt-2"><span class="font-semibold">Contesto & Focus:</span> ${item.focus_raw}</p>
                    ${culturalInfo}
                    ${arrivalInfo} `;

                return {
                    giorno: giornoNumber,
                    ora: item.ora,
                    attivita: item.attivita.replace(/\\rightarrow/g, '‚Üí'), // Corregge la freccia
                    luogo: item.luogo.replace(/\\rightarrow/g, '‚Üí'),
                    focus: focus,
                    note: item.note,
                    dettagli: combinedDettagli
                };
            });
        }

        window.toggleDetails = function(id) {
            const element = document.getElementById(id);
            const button = event.target;
            
            if (element.classList.contains('hidden')) {
                element.classList.remove('hidden');
                button.textContent = 'Nascondi Dettagli';
            } else {
                element.classList.add('hidden');
                button.textContent = 'Mostra Dettagli';
            }
        };

        const navButtons = document.querySelectorAll('.nav-button');
        const pages = document.querySelectorAll('.tab-content');
        
        window.showPage = function(pageId) {
            pages.forEach(page => { page.style.display = 'none'; });
            const targetPage = document.getElementById(pageId);
            if (targetPage) { targetPage.style.display = 'block'; }

            navButtons.forEach(button => { button.classList.remove('active-tab'); });
            const activeButton = document.querySelector(`button[data-page="${pageId}"]`);
            if (activeButton) { activeButton.classList.add('active-tab'); }
        }

        function renderTimeline(day, containerId) {
            const container = document.getElementById(containerId);
            const dailyData = itineraryData.filter(item => item.giorno === day);
            let htmlTimeline = '';

            dailyData.forEach((item, index) => {
                const iconName = item.focus; 
                const uniqueId = `${containerId}-details-${index}`;
                
                htmlTimeline += `
                    <div class="timeline-item relative py-4">
                        <div class="timeline-point absolute -left-0.5 top-6 w-3 h-3 rounded-full z-10"></div>
                        <div class="bg-white p-4 ml-4 rounded-lg shadow-md hover:shadow-xl transition duration-300 transform hover:scale-[1.01]">
                            <div class="flex items-start mb-2 justify-between">
                                <div class="flex items-center">
                                    <i data-lucide="${iconName}" class="w-5 h-5 mr-3 accent-color shrink-0"></i>
                                    <span class="font-bold text-lg accent-color">${item.attivita}</span>
                                </div>
                                 <span class="text-sm font-semibold text-gray-500">${item.ora}</span>
                            </div>
                            <p class="text-sm text-gray-700 mb-2 pl-8">üìç ${item.luogo.replace(/\\rightarrow/g, '‚Üí')}</p>
                            
                            <button 
                                class="details-btn text-xs font-semibold text-white py-1 px-3 rounded-full mt-2 no-print"
                                onclick="toggleDetails('${uniqueId}')"
                            >
                                Mostra Dettagli
                            </button>
                            <div id="${uniqueId}" class="hidden mt-3 pt-3 text-sm">
                                ${item.dettagli}
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = htmlTimeline;
        }

        function renderSummary() {
            const summaryContainer = document.getElementById('summary-container');
            let htmlSummary = '';
            let lastDay = 0;

            itineraryData.forEach(item => {
                if (item.giorno !== lastDay) {
                    htmlSummary += `
                        <h3 class="text-xl font-bold mt-6 pb-1 border-b-2 border-gray-300 accent-color">
                            Giorno ${item.giorno}
                        </h3>
                        <ul class="list-disc list-inside space-y-1 ml-4">
                    `;
                    lastDay = item.giorno;
                }
                
                htmlSummary += `
                    <li class="text-gray-700">
                        <span class="font-semibold">${item.ora}:</span> ${item.attivita} (<span class="italic">${item.luogo.replace(/\\rightarrow/g, '‚Üí')}</span>)
                    </li>
                `;

                if (itineraryData.length === itineraryData.indexOf(item) + 1 || itineraryData[itineraryData.indexOf(item) + 1].giorno !== lastDay) {
                    htmlSummary += `</ul>`;
                }
            });

            summaryContainer.innerHTML = htmlSummary;
        }

        function renderFoodShowcases() {
            const containerMap = {
                "Piatti tipici": "showcase-piatti",
                "Le merende reali": "showcase-merende",
                "Drink": "showcase-drink"
            };

            for (const category in newFoodData) {
                const id = containerMap[category];
                const container = document.getElementById(id);
                let htmlContent = '';

                newFoodData[category].forEach(item => {
                    htmlContent += `
                        <div class="bg-gray-50 p-3 rounded-lg mt-3 border border-gray-200">
                            <h4 class="font-bold text-lg">${item.titolo}</h4>
                            <p class="text-sm text-gray-700 mt-1">${item.descrizione}</p>
                            <p class="text-xs text-gray-500 mt-2 italic border-t pt-2">
                                üìç Dove: ${item.indirizzi}
                                <br>
                                üóìÔ∏è Suggerimento: ${item.suggerito}
                            </p>
                        </div>
                    `;
                });
                if (container) {
                     // Solo append, l'header h3 √® gi√† nell'HTML statico
                     container.innerHTML += htmlContent;
                }
            }
        }

        function renderBudgetAndStats() {
            const costs = budgetData.map(item => item.costo);
            const totalCost = costs.reduce((sum, cost) => sum + cost, 0);
            
            document.getElementById('total-budget-display').textContent = `‚Ç¨ ${totalCost.toFixed(2)}`;
            const kpiContainer = document.getElementById('kpi-summary');
            let htmlKpi = '';
            
            budgetData.forEach(item => {
                 htmlKpi += `
                    <div class="flex items-center">
                        <i data-lucide="${item.icon}" class="w-4 h-4 mr-2 text-gray-700"></i>
                        <span class="font-semibold">${item.categoria}:</span>
                        <span class="ml-auto font-bold">${item.costo.toFixed(2)} ‚Ç¨</span>
                    </div>
                `;
            });
            kpiContainer.innerHTML = htmlKpi;
            
            if (window.matchMedia('print').matches) return;

            const categories = budgetData.map(item => item.categoria.split('(')[0].trim());
            const imperialColors = ['#8C0000', '#C8AA50', '#A52A2A', '#D4AF37', '#B22222'];
            
            const ctx = document.getElementById('budgetChart').getContext('2d');
            
            // Distruggi e ricrea il grafico per evitare errori in caso di hot-reloading
            if (window.budgetChartInstance) {
                window.budgetChartInstance.destroy();
            }

            window.budgetChartInstance = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: categories,
                    datasets: [{
                        data: costs,
                        backgroundColor: imperialColors,
                        borderColor: 'white',
                        borderWidth: 2,
                        hoverOffset: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right' },
                        title: {
                            display: true,
                            text: `Costo Totale Stimato: ‚Ç¨ ${totalCost.toFixed(2)}`,
                            font: { size: 16, family: 'Georgia, serif' },
                            color: getComputedStyle(document.documentElement).getPropertyValue('--color-primary')
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) { label += ': '; }
                                    label += new Intl.NumberFormat('it-IT', { style: 'currency', currency: 'EUR' }).format(context.raw);
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            initializeData();
            renderSummary();
            renderTimeline(1, 'timeline-GIORNO1');
            renderTimeline(2, 'timeline-GIORNO2');
            renderTimeline(3, 'timeline-GIORNO3');
            renderTimeline(4, 'timeline-GIORNO4');
            renderFoodShowcases();
            renderBudgetAndStats();
            
            // CHIAMATA ESSENZIALE PER RENDERE TUTTE LE ICONE DOPO IL CARICAMENTO DEI DATI
            lucide.createIcons(); 
            
            // Mostra la pagina di default
            showPage('page-GIORNO3'); // Mostro Giorno 3 per far vedere subito le modifiche.
        });
    </script>
</body>
</html>
