<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vienna Imperiale - Guida Interattiva Modulare</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* DESIGN SYSTEM IMPERIALE */
        :root {
            --color-primary: #8C0000; /* Bordeaux Scuro (rich red) */
            --color-secondary: #C8AA50; /* Oro Antico (muted gold) */
            --color-background: #FAF8F4; /* Crema/Bianco Sporco */
            --color-text: #2c2c2c;
            --color-nav-bg: #4A4A4A; /* Grigio scuro per la navbar */
        }

        body {
            font-family: 'Georgia', serif;
            background-color: var(--color-background);
            color: var(--color-text);
        }

        /* HEADER & NAV BAR */
        .header-bg {
            background-color: var(--color-primary);
            color: white;
            border-bottom: 6px solid var(--color-secondary);
        }
        .nav-bg {
            background-color: var(--color-nav-bg); 
        }
        .nav-button {
            transition: all 0.2s;
            flex-shrink: 0; 
        }
        .nav-button:hover {
            background-color: #6C0000;
        }
        .active-tab { 
            background-color: var(--color-primary);
            font-weight: bold;
            border-bottom: 3px solid var(--color-secondary);
        }
        .intro-accent {
            color: var(--color-secondary); 
            font-weight: bold; 
        }

        /* VISUALIZZAZIONE TIMELINE */
        .accent-color { color: var(--color-primary); }
        .border-accent { border-color: var(--color-secondary); }
        .timeline-item { border-left: 2px solid var(--color-secondary); }
        .timeline-point {
            background-color: var(--color-primary);
            border: 4px solid var(--color-secondary);
        }
        .details-btn { background-color: var(--color-primary); }
        .details-btn:hover { background-color: #6C0000; }

        /* VETRINE CIBO */
        .food-showcase {
            background-color: white;
            border-top: 5px solid var(--color-primary);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        /* SEZIONI PAGINA */
        .tab-content {
            display: none; 
            min-height: 85vh; 
        }
        
        /* OTTIMIZZAZIONE PER LA STAMPA (PDF) */
        @media print {
            body { background-color: white !important; color: black !important; font-size: 10pt; }
            .fixed-element, .no-print { display: none !important; }
            .header-bg {
                background-color: white !important; color: black !important;
                border-bottom: 1px solid black !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .timeline-item { border-left: 1px dashed gray; }
            .timeline-point { background-color: white !important; border-color: black !important; }
            
            .tab-content { display: block !important; } 
            .hidden { display: block !important; } 
            
            #page-PANORAMICA, #page-GIORNO1, #page-GIORNO2, #page-GIORNO3, #page-GIORNO4, #page-CIBO, #page-BUDGET {
                 page-break-after: always; 
            }
            #page-BUDGET { page-break-after: avoid; }
        }
    </style>
</head>
<body>
    <header class="header-bg shadow-lg fixed top-0 w-full z-50 h-12 md:h-14 fixed-element">
        <div class="max-w-6xl mx-auto px-4 py-2 md:py-3">
            <h1 class="text-lg md:text-xl font-extrabold tracking-wider text-center pt-0.5">GUIDA VIENNA: L'EFFICACIA IMPERIALE</h1>
        </div>
    </header>

    <nav class="nav-bg fixed top-12 md:top-14 w-full z-40 shadow-xl h-10 fixed-element">
        <div class="max-w-6xl mx-auto px-4">
            <div class="flex overflow-x-auto whitespace-nowrap justify-start md:justify-center gap-1 text-sm md:text-base pt-1">
                <button onclick="showPage('page-PANORAMICA')" class="nav-button px-3 py-0.5 text-white" data-page="page-PANORAMICA">PANORAMICA</button>
                <button onclick="showPage('page-GIORNO1')" class="nav-button px-3 py-0.5 text-white" data-page="page-GIORNO1">GIORNO 1: VENERD√å 5</button>
                <button onclick="showPage('page-GIORNO2')" class="nav-button px-3 py-0.5 text-white" data-page="page-GIORNO2">GIORNO 2: SABATO 6</button>
                <button onclick="showPage('page-GIORNO3')" class="nav-button px-3 py-0.5 text-white" data-page="page-GIORNO3">GIORNO 3: DOMENICA 7</button>
                <button onclick="showPage('page-GIORNO4')" class="nav-button px-3 py-0.5 text-white" data-page="page-GIORNO4">GIORNO 4: LUNED√å 8</button>
                <button onclick="showPage('page-CIBO')" class="nav-button px-3 py-0.5 text-white" data-page="page-CIBO">CIBO</button>
                <button onclick="showPage('page-BUDGET')" class="nav-button px-3 py-0.5 text-white" data-page="page-BUDGET">BUDGET E STATISTICHE</button>
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto p-4 sm:p-6 lg:p-8 pt-[88px] md:pt-24">

        <section id="page-PANORAMICA" class="tab-content">
            <h2 class="text-3xl font-bold mb-6 pb-2 border-b border-accent accent-color flex items-center">
                <i data-lucide="scan" class="mr-2 text-2xl"></i> Panoramica Veloce: L'Essenza del Viaggio
            </h2>
            <div id="summary-container" class="space-y-6">
                <p class="text-lg italic text-gray-700">Caricamento itinerario sintetico...</p>
            </div>
        </section>

        <section id="page-GIORNO1" class="tab-content">
            <h2 class="text-3xl font-bold mb-8 pb-2 border-b border-accent accent-color flex items-center">
                <i data-lucide="calendar-check" class="mr-2 text-2xl"></i> Giorno 1: Venerd√¨ 5 - Arrivo, Arte & Concerto Fissato (ITINERARIO EFFETTIVO E CRONOLOGICO)
            </h2>
            <p class="text-lg mb-6 bg-white p-4 rounded-lg shadow-md border-l-4 border-accent">
                <span class="intro-accent">Aggiornamento:</span> Questo itinerario riflette l'esatta **ricostruzione cronologica** del tuo viaggio di arrivo (dalle 05:21 alle 22:09), basato sui dati di geolocalizzazione. La visita a **Hundertwasser** √® stata la prima, il **Caf√© Friedlich** una pausa caff√® interna, il **Belvedere** ha avuto una visita molto lunga e la cena si √® svolta al **Zum Kellergw√∂lb**.
            </p>
            <div id="timeline-GIORNO1" class="relative mt-4"></div>
        </section>

        <section id="page-GIORNO2" class="tab-content">
            <h2 class="text-3xl font-bold mb-8 pb-2 border-b border-accent accent-color flex items-center">
                <i data-lucide="calendar-check" class="mr-2 text-2xl"></i> Giorno 2: Sabato 6 - Impero, Mercati & Biblioteca (ITINERARIO EFFETTIVO E CRONOLOGICO)
            </h2>
            <p class="text-lg mb-6 bg-white p-4 rounded-lg shadow-md border-l-4 border-accent">
                <span class="intro-accent">Aggiornamento:</span> Questa giornata √® stata intensa (07:59 ‚Äì 22:36). Ti sei concentrato su **Sch√∂nbrunn e la Gloriette (lunga visita)**, pranzo street food al **Naschmarkt** e un pomeriggio culturale con la **Biblioteca Nazionale (Prunksaal)**. Hai saltato il Museo di Sissi e la Chiesa dei Gesuiti. La sera si √® conclusa con cena al **Reinthaler's Beisl** e **Rathausplatz** illuminata.
            </p>
            <div id="timeline-GIORNO2" class="relative mt-4"></div>
        </section>
        
        <section id="page-GIORNO3" class="tab-content">
            <h2 class="text-3xl font-bold mb-8 pb-2 border-b border-accent accent-color flex items-center">
                <i data-lucide="calendar-check" class="mr-2 text-2xl"></i> Giorno 3: Domenica 7 - Trekking, Prater, Barocco & Kaiserschmarrn (ITINERARIO EFFETTIVO/PIANO)
            </h2>
            <p class="text-lg mb-6 bg-white p-4 rounded-lg shadow-md border-l-4 border-accent">
                <span class="intro-accent">Aggiornamento:</span> Mattinata sportiva (08:39 ‚Äì 12:14) con **8.1 km a piedi** nella zona del Danubio e spesa al BILLA. Il pomeriggio sar√† un mix di divertimento **(Prater veloce)**, barocco nascosto **(Chiesa dei Gesuiti)** e un momento goloso **(Kaiserschmarrn)**, prima di finire la sera con il **Concerto d'Avvento** a Rathausplatz e la cena al **Caf√® Anzengruber**.
            </p>
            <div id="timeline-GIORNO3" class="relative mt-4"></div>
        </section>

        <section id="page-GIORNO4" class="tab-content">
            <h2 class="text-3xl font-bold mb-8 pb-2 border-b border-accent accent-color flex items-center">
                <i data-lucide="calendar-check" class="mr-2 text-2xl"></i> Giorno 4: Luned√¨ 8 - Cultura Finale, Acquisti e Partenza (PIANO PROGRAMMATO)
            </h2>
            <p class="text-lg mb-6 bg-white p-4 rounded-lg shadow-md border-l-4 border-accent">
                <span class="intro-accent">Intro:</span> La mattina √® dedicata al **Wien Museum** (ancora da visitare), logisticamente vicino a Karlsplatz, un ottimo punto di partenza per il transfer in aeroporto. Acquisti finali e partenza.
            </p>
            <div id="timeline-GIORNO4" class="relative mt-4"></div>
        </section>

        <section id="page-CIBO" class="tab-content">
            <h2 class="text-3xl font-bold mb-8 pb-2 border-b border-accent accent-color flex items-center">
                <i data-lucide="utensils" class="mr-2 text-2xl"></i> Delizie Culinarie di Vienna
            </h2>
            <div id="food-showcases" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div id="showcase-piatti" class="food-showcase p-5 rounded-xl">
                    <h3 class="text-2xl font-bold accent-color mb-4">üçΩÔ∏è Piatti Tipici (Pranzi & Cene)</h3>
                </div>
                <div id="showcase-merende" class="food-showcase p-5 rounded-xl">
                    <h3 class="text-2xl font-bold accent-color mb-4">üç∞ Le Merende Reali (Dolci & Caf√©)</h3>
                </div>
                <div id="showcase-drink" class="food-showcase p-5 rounded-xl">
                    <h3 class="text-2xl font-bold accent-color mb-4">‚òï Drink (Caldi & Mercatino)</h3>
                </div>
            </div>
        </section>

        <section id="page-BUDGET" class="tab-content">
            <h2 class="text-3xl font-bold mb-8 pb-2 border-b border-accent accent-color flex items-center">
                <i data-lucide="wallet" class="mr-2 text-2xl"></i> Analisi Budget e Statistiche
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="md:col-span-1 bg-white p-6 rounded-xl shadow-xl border-l-4 border-accent">
                    <h3 class="text-xl font-bold accent-color mb-4">Riepilogo Totale</h3>
                    <p class="text-4xl font-extrabold" id="total-budget-display">‚Ç¨ XXX.XX</p>
                    <p class="text-sm mt-2 text-gray-600">Costo stimato per persona (esclusi voli).</p>
                    <div id="kpi-summary" class="mt-6 space-y-3 text-sm">
                    </div>
                </div>

                <div class="md:col-span-2 bg-white p-6 rounded-xl shadow-xl border-l-4 border-accent no-print">
                    <h3 class="text-xl font-bold accent-color mb-4">Ripartizione Costi (Grafico)</h3>
                    <div class="chart-container" style="height: 350px;">
                        <canvas id="budgetChart"></canvas>
                    </div>
                    <p class="text-center text-sm mt-4 italic text-gray-500">I costi sono stimati e arrotondati.</p>
                </div>
            </div>
        </section>

    </main>

    <script>
        // ===========================================
        // 1. DATI (Giorno 1-3: EFFETTIVO/PIANO - Giorno 4: PROGRAMMATO)
        // ===========================================
        
        // Dati Itinerario
        const rawItineraryData = [
            // PARTE 1: PARTENZA DALL'ITALIA (Giorno 1 EFFETTIVO)
            { giorno: "Giorno 1: Ven 5 - Arrivo, Arte & Concerto Fissato", ora: "05:21 ‚Äì 07:39", attivita: "Bus Torino ‚Üí Malpensa", luogo: "Torino ‚Üí Malpensa Aeroporto", note: "Uscita di casa alle 05:21, Spostamento in auto e poi Bus (1h 47min, 143 km).", focus_raw: "Trasferimento iniziale. Viaggio lungo per l'opzione pi√π economica. | Sveglia all'alba!" },
            { giorno: "Giorno 1", ora: "07:39 ‚Äì 09:08", attivita: "Aeroporto Malpensa (Controlli/Gate)", luogo: "MXP", note: "Tempo dedicato ai controlli di sicurezza e all'attesa al gate (circa 1 ora e mezza).", focus_raw: "Logistica Aeroportuale. Essere pronti per l'imbarco." },
            { giorno: "Giorno 1", ora: "09:08 ‚Äì 10:17", attivita: "Volo MXP ‚Üí VIE (Durata effettiva 1h 09m)", luogo: "MXP / VIE", note: "", focus_raw: "Volo diretto Milano Malpensa ‚Üí Vienna-Schwechat." },
            
            // PARTE 2: ARRIVO A VIENNA E QUARTIERE LANDSTRASSE (Giorno 1 EFFETTIVO)
            { giorno: "Giorno 1", ora: "10:17 ‚Äì 11:21", attivita: "Aeroporto Vienna (Sbarco/Treno)", luogo: "Flughafen Wien (VIE)", note: "Sbarco, ritiro bagagli e spostamento verso la stazione ferroviaria dell'aeroporto.", focus_raw: "Logistica Arrivo. Acquistare Vienna Pass/Biglietti Trasporto Pubblico." },
            { giorno: "Giorno 1", ora: "11:21 ‚Äì 11:59", attivita: "Treno/Metro/Piedi ‚Üí Hundertwasser", luogo: "VIE ‚Üí Landstra√üe ‚Üí Kunst Haus Wien", note: "Trasferimento via Treno (S7/CAT) a Landstra√üe/Wien Mitte (11:21-11:50), pi√π brevi spostamenti finali con metro e a piedi.", focus_raw: "Trasferimento rapido in citt√†. Bagagli al seguito." },
            
            // FOCUS: ARCHITETTURA DI HUNDERTWASSER (Giorno 1 EFFETTIVO)
            { giorno: "Giorno 1", ora: "11:59 ‚Äì 13:00", attivita: "Kunst Haus Wien (Museo Hundertwasser)", luogo: "Kunst Haus Wien / Caf√© Friedlich", note: "**Visita del museo (61 minuti).** Sosta per una Pausa Caff√® Artistica al Caf√© Friedlich all'interno del museo. **Correzione: non era un pranzo.**", focus_raw: "Recupero dell'arte ecologica di Hundertwasser. Focus Arte: Stravaganza e colore." },
            { giorno: "Giorno 1", ora: "13:05 ‚Äì 13:50", attivita: "Hundertwasser Village (Zona Commerciale)", luogo: "Hundertwasser Village (Kegelgasse 37/39)", note: "Esplorazione della zona commerciale unica di fronte alla casa. Tempo speso: 45 minuti.", focus_raw: "Focus Architettura: L'esterno colorato e le forme organiche." },
            
            // PARTE 3: POMERIGGIO IMPERIALE (Giorno 1 EFFETTIVO)
            { giorno: "Giorno 1", ora: "13:50 ‚Äì 15:35", attivita: "Spostamento & Lunga Passeggiata (Forse Pranzo Veloce)", luogo: "Landstra√üe ‚Üí Schottenring ‚Üí Castello del Belvedere", note: "Lungo tratto con cambi metro/piedi (1h 45m). Il tempo lungo suggerisce una passeggiata lenta o una sosta per un pranzo veloce non tracciato formalmente (es. W√ºrstelstand).", focus_raw: "Passeggiata lenta in centro storico dirigendosi verso sud. Nessun pranzo formale registrato." },
            { giorno: "Giorno 1", ora: "15:35 ‚Äì 18:12", attivita: "Castello del Belvedere (Visita Approfondita)", luogo: "Schloss Belvedere (√ñsterreichische Galerie)", note: "**Visita approfondita di 2 ore e 37 minuti.** Costo: 24‚Ç¨.", focus_raw: "Capolavoro barocco del Principe Eugenio. Focus Arte: Assolutamente da non perdere 'Il Bacio'." },
            { giorno: "Giorno 1", ora: "18:12 ‚Äì 18:37", attivita: "Karlskirche (Chiesa di San Carlo Borromeo)", luogo: "Karlskirche", note: "Breve spostamento e visita molto rapida di 6 minuti, probabilmente solo esterna o un'occhiata veloce. Tram da Belvedere (18:22-18:28).", focus_raw: "Focus Architettura Barocca: La facciata imponente. Tappa veloce per la luce serale." },
            
            // PARTE 4: SERA (MUSICA E CENA) (Giorno 1 EFFETTIVO)
            { giorno: "Giorno 1", ora: "18:40 ‚Äì 20:28", attivita: "B√∂sendorfer Salon (Concerto/Showroom)", luogo: "B√∂sendorfer Salon (B√∂sendorferstra√üe 12)", note: "**Concerto/Evento FISSATO!** Quasi 2 ore dedicate alla musica (1h 48m).", focus_raw: "Focus Cultura: Concerto di musica classica. Ambiente elegante." },
            { giorno: "Giorno 1", ora: "20:48 ‚Äì 21:47", attivita: "Cena al Zum Kellergw√∂lb", luogo: "Zum Kellergw√∂lb (Seilerst√§tte 13)", note: "**Cena effettiva (59 minuti)** in questo ristorante tradizionale con cucina austriaca (Beisl storico).", focus_raw: "Focus Culinario: Cena in Beisl storico, Schnitzel o Gulasch." },
            { giorno: "Giorno 1", ora: "21:47 ‚Äì 22:09", attivita: "Passeggiata Notturna & Arrivo alloggio", luogo: "1¬∞ Distretto ‚Üí Vereinsgasse 3 (Leopoldstadt)", note: "Passeggiata notturna di rientro di 2,7 km.", focus_raw: "Fine della giornata intensa. Rientro alloggio." },
            
            // Dati Giorno 2 (EFFETTIVO E CRONOLOGICO)
            { giorno: "Giorno 2: Sab 6 - Impero, Mercati & Biblioteca", ora: "07:59 ‚Äì 08:28", attivita: "Uscita & Spesa Veloce", luogo: "Vereinsgasse ‚Üí Lidl (Heinestra√üe) ‚Üí Schwedenplatz", note: "Spesa per colazione/snack (8:03-8:12) e spostamento verso la metro. Inizio giornata: 07:59. Rientro: 22:36.", focus_raw: "Logistica Iniziale. Colazione low-cost." },
            { giorno: "Giorno 2", ora: "08:28 ‚Äì 08:54", attivita: "Metro & Avvicinamento Sch√∂nbrunn", luogo: "Schwedenplatz ‚Üí Sch√∂nbrunn", note: "Viaggio in metropolitana U4 (6,5 km) verso la periferia imperiale.", focus_raw: "Trasferimento rapido. Sfruttare la prima ora di apertura." },
            { giorno: "Giorno 2", ora: "08:54 ‚Äì 10:05", attivita: "Palazzo di Sch√∂nbrunn (Visita Interni/Cortili)", luogo: "Sch√∂nbrunn Palace, 1130 Wien", note: "**Visita effettiva di 1 ora e 11 minuti.**", focus_raw: "Residenza estiva degli Asburgo. Focus Storico: Vita di Sissi e Francesco Giuseppe." },
            { giorno: "Giorno 2", ora: "10:05 ‚Äì 11:22", attivita: "Giardini & Gloriette Sch√∂nbrunn", luogo: "Sch√∂nbrunn Gardens / Gloriette", note: "**Sosta lunga (35 min) alla Gloriette** per il panorama. Passeggiata totale nei giardini: 1h 17m.", focus_raw: "Panorama sulla citt√†. Focus Architettura: L'arco trionfale della Gloriette." },
            { giorno: "Giorno 2", ora: "11:22 ‚Äì 12:08", attivita: "Discesa & Spostamento Metro", luogo: "Sch√∂nbrunn Gardens ‚Üí Kettenbr√ºckengasse", note: "Passeggiata di 45 minuti verso la stazione metro, seguita da un breve viaggio U4 (12:08-12:14).", focus_raw: "Logistica trasferimento." },
            { giorno: "Giorno 2", ora: "12:15 ‚Äì 13:30", attivita: "Naschmarkt (Passeggiata)", luogo: "Naschmarkt, 1060 Wien", note: "Passeggiata di oltre un'ora tra le bancarelle del mercato storico.", focus_raw: "Il mercato pi√π grande di Vienna. Atmosfera internazionale." },
            { giorno: "Giorno 2", ora: "13:30 ‚Äì 14:35", attivita: "Pranzo da U(H)RWURSCHT (W√ºrstel)", luogo: "Minerlgasse 129 (Naschmarkt)", note: "**Pranzo effettivo di 1 ora e 5 minuti** in un chiosco/imbiss. Un classico W√ºrstel viennese.", focus_raw: "Pranzo veloce e tipico street food low-cost." },
            { giorno: "Giorno 2", ora: "14:35 ‚Äì 16:20", attivita: "Grande Passeggiata (3,1 km) verso il Centro", luogo: "Naschmarkt ‚Üí Hofburg/Biblioteca", note: "Passeggiata lenta e prolungata (1 ora e 45 minuti) per godersi l'architettura della citt√†. **Attenzione: Visita Hofburg e Sissi Museum saltata.**", focus_raw: "Passeggiata architettonica. Direzione Hofburg." },
            { giorno: "Giorno 2", ora: "16:20 ‚Äì 17:40", attivita: "Biblioteca Nazionale (Prunksaal)", luogo: "Josefsplatz 1, Hofburg", note: "**Visita molto approfondita di 1 ora e 20 minuti.** Costo: 10‚Ç¨.", focus_raw: "La sala barocca pi√π bella del mondo. Focus Cultura: Biblioteche storiche." },
            { giorno: "Giorno 2", ora: "17:40 ‚Äì 18:55", attivita: "Passeggiata Lenta & Ferstel Passage", luogo: "Centro Storico (1¬∞ Distretto) / Ferstel Passage (18:40-18:55)", note: "Passeggiata di 1 ora in centro, inclusa l'elegante galleria commerciale storica.", focus_raw: "Focus Architettura: Gallerie e dettagli del centro storico." },
            { giorno: "Giorno 2", ora: "19:15 ‚Äì 20:35", attivita: "Cena al Reinthaler's Beisl", luogo: "Dorotheergasse, 1010 Wien", note: "**Cena effettiva di 1 ora e 20 minuti.** Tipica trattoria viennese. **Prenotazione consigliata in futuro.**", focus_raw: "Focus Culinario: Cena in Beisl autentico (Gulasch o Schnitzel)." },
            { giorno: "Giorno 2", ora: "21:18 ‚Äì 22:16", attivita: "Rathausplatz (Piazza del Municipio Illuminato)", luogo: "Rathausplatz, 1010 Wien", note: "Trascorso quasi **1 ora in piazza** (21:18-22:16). Probabilmente ammirando l'illuminazione o i mercatini.", focus_raw: "Focus Serale: Il Municipio illuminato e l'atmosfera notturna." },
            { giorno: "Giorno 2", ora: "22:16 ‚Äì 22:36", attivita: "Rientro all'Alloggio", luogo: "Rathausplatz ‚Üí Vereinsgasse 2", note: "Ultimi spostamenti Metro e a piedi.", focus_raw: "Fine della giornata intensa. Rientro alloggio." },
            
            // Dati Giorno 3 (EFFETTIVO MATTINA + NUOVO PIANO POMERIGGIO)
            { giorno: "Giorno 3: Dom 7 - Trekking, Prater, Barocco & Kaiserschmarrn", ora: "08:39 ‚Äì 09:31", attivita: "Uscita, Camminata & Spesa Lunga (BILLA)", luogo: "Vereinsgasse ‚Üí Wien Praterstern", note: "Sosta di 45 minuti a Praterstern, con visita a BILLA per colazione/scorte. Inizio giornata: 08:39.", focus_raw: "Logistica Iniziale. Preparazione per la lunga escursione. | Spesa low-cost." },
            { giorno: "Giorno 3", ora: "09:31 ‚Äì 11:50", attivita: "Trekking Urbano (8.1 km) - Alte Donau / Transdanubia", luogo: "Kaiserm√ºhlen VIC ‚Üí Stadlau / Alte Donau", note: "Lunga camminata esplorativa di quasi 2 ore (8.1 km totali). Metro U1 all'inizio. Ritorno con metro/bus (11:19 - 11:50).", focus_raw: "Focus Sportivo: Esplorazione delle rive del Vecchio Danubio e della Vienna moderna. | Rilancio delle energie." },
            { giorno: "Giorno 3", ora: "11:50 ‚Äì 13:00", attivita: "Rientro all'Alloggio e Pausa Pranzo", luogo: "Praterstern ‚Üí Vereinsgasse 2", note: "Rientro all'alloggio per una pausa necessaria o per consumare il pranzo preparato (al sacco). Fine della mattinata intensa.", focus_raw: "Pausa necessaria. Pranzo al sacco o veloce a casa." },
            { giorno: "Giorno 3", ora: "14:00 ‚Äì 15:30", attivita: "Prater (Visita Veloce)", luogo: "Wurstelprater, 1020 Wien", note: "Dall'alloggio, a piedi fino al parco. Focus sulla Ruota Panoramica (Riesenrad) e l'atmosfera storica, senza usare giostre (focus veloce).", focus_raw: "Focus Divertimento: Il pi√π antico parco divertimenti del mondo. Atmosfera vintage." },
            { giorno: "Giorno 3", ora: "15:30 ‚Äì 16:30", attivita: "Chiesa dei Gesuiti (Jesuitenkirche)", luogo: "Dr. Ignaz Seipel-Platz 1, 1010 Wien", note: "Metro U1 da Praterstern verso Schwedenplatz. Ingresso gratuito. Un gioiello barocco poco visitato.", focus_raw: "Focus Architettura: Interni barocchi sontuosi, affreschi trompe-l'oeil." },
            { giorno: "Giorno 3", ora: "16:30 ‚Äì 17:30", attivita: "Merenda: Kaiserschmarrn (Frittata dell'Imperatore)", luogo: "Caf√© Landtmann (o simile in centro)", note: "Pausa dolce e sostanziosa per riprendere le energie. Il 'dessert del re'.", focus_raw: "Focus Culinario: Il dolce imperiale per eccellenza. Molto sostanzioso." },
            { giorno: "Giorno 3", ora: "17:30 ‚Äì 19:00", attivita: "Mercatini & Concerto d'Avvento", luogo: "Rathausplatz, 1010 Wien", note: "Concerto d'Avvento: Orario effettivo 17:30 - 19:00. Non √® necessario restare per intero. Atmosfera serale del Municipio illuminato.", focus_raw: "Focus Serale & Cultura: Musica classica gratuita e l'atmosfera natalizia." },
            { giorno: "Giorno 3", ora: "19:00 ‚Äì 20:30", attivita: "Passeggiata Lenta e Spostamento per Cena", luogo: "Centro Storico ‚Üí Schleifm√ºhlgasse (4¬∞ Distretto)", note: "Passeggiata post-concerto verso la zona del Caf√® Anzengruber (vicino al Naschmarkt).", focus_raw: "Passeggiata notturna. Logistica verso la cena." },
            { giorno: "Giorno 3", ora: "20:30 ‚Äì 22:00", attivita: "Cena al Caf√® Anzengruber", luogo: "Caf√® Anzengruber (Schleifm√ºhlgasse 19, 1040 Wien)", note: "Beisl autentico e popolare per l'ultima cena salata. **Prenotazione consigliata!**", focus_raw: "Focus Culinario: Piatti caldi e confortevoli in un ambiente tradizionale." },
            { giorno: "Giorno 3", ora: "22:00 ‚Äì 22:30", attivita: "Rientro all'Alloggio", luogo: "Caf√® Anzengruber ‚Üí Vereinsgasse 2", note: "Ultimo rientro della giornata. Metro U1/U4 o Taxi.", focus_raw: "Fine della giornata intensa. Rientro alloggio." },

            // Dati Giorno 4 (PIANO PROGRAMMATO)
            { giorno: "Giorno 4: Lun 8 - Cultura Finale, Acquisti e Partenza", ora: "09:00", attivita: "Colazione e Ultimo T√®", luogo: "Hotel/Konditorei", note: "Colazione tranquilla e preparazione degli zaini. Consiglio: Ultima Sachertorte o Apfelstrudel.", focus_raw: "Ultima colazione viennese." },
            { giorno: "Giorno 4", ora: "10:00", attivita: "Wien Museum Karlsplatz (Tappa finale)", luogo: "Wien Museum Karlsplatz", note: "Metro U4/U1 per Karlsplatz (4¬∞ distretto). Costo: ‚âà 12‚Ç¨. Ottimo per l'aeroporto.", focus_raw: "Focus Culturale: Storia civica di Vienna. L'ultimo museo richiesto." },
            { giorno: "Giorno 4", ora: "11:30", attivita: "Acquisto Souvenir e Check-out", luogo: "Karlsplatz / Rientro Hotel", note: "Ultimi acquisti. Acquista Mozartkugel/Manner Wafers nei supermercati. Rientro in hotel per il check-out (12:00).", focus_raw: "Acquisti finali." },
            { giorno: "Giorno 4", ora: "13:00", attivita: "Pranzo Veloce & Trasferimento Aeroporto", luogo: "Hotel ‚Üí Aeroporto", note: "Pranzo rapido prima di dirigersi verso la S7 o il CAT. Logistica: **Consigliato il CAT** se si parte da Wien Mitte (16 min).", focus_raw: "Partenza da Vienna ore 16:35. Lasciarsi largo anticipo." },
            { giorno: "Giorno 4", ora: "16:35 - 18:05", attivita: "Volo VIE ‚Üí MXP", luogo: "VIE / MXP", note: "", focus_raw: "Volo di ritorno per Malpensa." },
            { giorno: "Giorno 4", ora: "19:00", attivita: "Bus Malpensa ‚Üí Torino", luogo: "MXP ‚Üí Torino", note: "", focus_raw: "Trasferimento finale in bus. | Fine del viaggio." }
        ];

        // Dati Cibo (AGGIORNATO CON KAISERSCHMARRN)
        const newFoodData = {
            "Piatti tipici": [
                { 
                    titolo: "Pranzo da U(H)RWURSCHT (Effettivo Giorno 2)", 
                    descrizione: "Tipico chiosco di W√ºrstel (Imbiss) al Naschmarkt. L'opzione migliore per un pranzo veloce, caldo e low-cost. Qui hai consumato il tuo pranzo del Giorno 2. Il classico W√ºrstel Viennese (es. K√§sekrainer).", 
                    indirizzi: "U(H)RWURSCHT (Minerlgasse 129, Naschmarkt). Costo: ‚âà 5-8‚Ç¨.", 
                    suggerito: "Giorno 2: 13:30 - Pranzo Veloce." 
                },
                { 
                    titolo: "Cena al Reinthaler's Beisl (Effettivo Giorno 2)", 
                    descrizione: "Beisl autentico nel 1¬∞ distretto. Qui hai cenato il Giorno 2. Noto per la sua atmosfera casalinga e piatti tradizionali come Gulasch. **Ottima scelta per l'autenticit√†.**", 
                    indirizzi: "Reinthaler's Beisl (Dorotheergasse 2-4, 1010 Wien). Costo: ‚âà 15 - 25‚Ç¨.", 
                    suggerito: "Giorno 2: 19:15 - Cena Tradizionale (Esperienza effettiva)." 
                },
                { 
                    titolo: "Cena al Zum Kellergw√∂lb (Effettivo Giorno 1)", 
                    descrizione: "Ristorante storico nel 1¬∞ distretto (Seilerst√§tte). Offre cucina tradizionale austriaca in un'atmosfera da cantina ('Kellergw√∂lb'). Qui hai cenato il Giorno 1.", 
                    indirizzi: "Zum Kellergw√∂lb (Seilerst√§tte 13, 1010 Wien). Costo: ‚âà 20-30‚Ç¨.", 
                    suggerito: "Giorno 1: 20:48 - Cena Post-Concerto." 
                },
                { titolo: "Cena al Caf√® Anzengruber (Previsto Giorno 3)", descrizione: "Un vero 'Beisl' vecchio stile, popolare tra i viennesi. Perfetto per un'ultima cena tradizionale. Serve piatti classici austriaci. **Prenotazione essenziale.**", indirizzi: "Caf√® Anzengruber (Schleifm√ºhlgasse 19, 1040 Wien). Costo: ‚âà 15 - 25‚Ç¨.", suggerito: "Giorno 3: 20:30 - Cena di Arrivederci." },
            ],
            "Drink": [
                { titolo: "Gl√ºhwein / Punsch", descrizione: "Vino caldo e speziato o punch (spesso con brandy o rum). Indispensabile per affrontare i mercatini. Ideale per riscaldarsi.", indirizzi: "Mercatini di Natale (qualsiasi chiosco). Costo: ‚âà 8-14‚Ç¨.", suggerito: "Giorno 3: 17:30 - Pausa Calda al Mercatino di Rathausplatz." }
            ],
            "Le merende reali": [
                { 
                    titolo: "Kaiserschmarrn", 
                    descrizione: "La 'Frittata dell'Imperatore'. Un dolce sofficissimo e spezzettato, servito con composta di prugne (Zwetschkenr√∂ster). √à molto sostanzioso, perfetto per una merenda serale.", 
                    indirizzi: "Caf√© Landtmann, Caf√© Sacher o qualsiasi Heuriger di qualit√†. Costo: ‚âà 10-15‚Ç¨.", 
                    suggerito: "Giorno 3: 16:30 - Merenda/Pausa in centro." 
                },
                { 
                    titolo: "Caf√© Friedlich (Pausa Caff√® Artistica - Giorno 1)", 
                    descrizione: "Una pausa caff√®/dolce all'interno del Kunst Haus Wien, il museo di Hundertwasser. Perfetto per godersi l'atmosfera artistica e riprendere le energie.", 
                    indirizzi: "Caf√© Friedlich, all'interno del Kunst Haus Wien, 1010 Wien. Costo: ‚âà 5-10‚Ç¨ (caff√®/dolce).", 
                    suggerito: "Giorno 1: 12:00 - Pausa Calda (Esperienza effettiva)." 
                },
                { titolo: "Pausa Caf√©/Atmosfera (Caf√© Central)", descrizione: "L'esperienza essenziale del caff√® viennese in un ambiente storico. Ottimo per riprendersi dalle lunghe camminate.", indirizzi: "Caf√© Central (Interni maestosi, low-cost se si ordina solo una bevanda). Costo: ‚âà 5‚Ç¨ per un Melange.", suggerito: "Giorno 4: 09:00 - Colazione/Merenda Finale (Se non provato al Giorno 2, che fu saltato)." },
                { titolo: "Apfelstrudel", descrizione: "Sfoglia sottile ripiena di mele, uvetta e cannella, servita calda (spesso con salsa alla vaniglia).", indirizzi: "Mercatini di Natale o qualsiasi Konditorei (pasticceria).", suggerito: "Giorno 4: 09:00 - Colazione/Merenda finale." },
                { titolo: "Sachertorte Originale", descrizione: "L'iconica torta al cioccolato e albicocca. Ottima per salutare Vienna.", indirizzi: "Hotel Sacher (la sede originale) o Konditorei di alta qualit√†. Costo: ‚âà 8-10‚Ç¨ a fetta.", suggerito: "Giorno 4: 09:00 - Colazione/Merenda finale." },
                { titolo: "Mozartkugel / Manner Wafers", descrizione: "Le famose palle di cioccolato al pistacchio (Mozartkugel) e i wafer alla nocciola (Manner, prodotto a Vienna).", indirizzi: "Supermercati (Billa, Spar) o negozi Manner. Evita i negozi di souvenir troppo cari.", suggerito: "Giorno 4: 11:30 - Acquisto Souvenir / Snack." }
            ]
        };

        // Dati Culturali (AGGIORNATO CON CHIESA DEI GESUITI)
        const culturalMap = {
            "Hundertwasserhaus": { descrizione: "Non √® solo un edificio, √® un manifesto contro la 'dittatura della linea retta'! L'artista Friedensreich Hundertwasser, un ribelle del design, l'ha concepita come un'oasi ecologica e umana. La visita √® stata ottimizzata con l'ingresso a KunstHausWien nel pomeriggio.", curiosita: "Il Diritto della Finestra: Hundertwasser credeva che ogni persona avesse il diritto di 'disegnare' l'area della parete attorno alla propria finestra, fin dove arrivava il suo braccio." },
            "Castello del Belvedere": { descrizione: "Un capolavoro barocco commissionato dal Principe Eugenio di Savoia. La sua Galleria Superiore custodisce il tesoro dell'Art Nouveau austriaco, con l'oro e l'erotismo dei capolavori di Gustav Klimt.", curiosita: "Il Giardino Segreto del Barocco: I giardini a terrazze sono un perfetto esempio di design barocco che riflette l'ordine e la ragione dell'Illuminismo." },
            "Duomo di Santo Stefano": { descrizione: "Conosciuta come Stephansdom, √® il cuore spirituale e geografico di Vienna. Le guglie gotiche dominano lo skyline.", curiosita: "La Porta del Gigante: La porta principale prende il nome dal femore di un mammut (o di un gigante, secondo la leggenda) appeso l√¨ per secoli." },
            "Hofburg Palace": { descrizione: "Per oltre 600 anni, questo √® stato il centro nevralgico dell'Impero Asburgico, la residenza invernale. Un complesso che abbraccia stili dall'architettura gotica al neoclassicismo.", curiosita: "Lo Stemma Nascosto di Sissi: Vicino agli appartamenti imperiali, ci sono dettagli nascosti che riflettono la personalit√† ribelle di Elisabetta (Sissi), che odiava l'etichetta di corte." },
            "Rathausplatz": { descrizione: "La tradizione dei mercatini risale al Medioevo. Oggi √® il pi√π grande e spettacolare, con le luci che avvolgono il maestoso Municipio in un'atmosfera da fiaba.", curiosita: "Il Municipio Protettore: La facciata gotica del Municipio (Rathaus) √® stata progettata per sovrastare il potere imperiale di Hofburg." },
            "Castello di Sch√∂nbrunn": { descrizione: "La residenza estiva degli Asburgo e il luogo preferito di Sissi. Un capolavoro barocco da esplorare dal Grand Tour agli estesi giardini.", curiosita: "R√∂mische Ruine (Sch√∂nbrunn): Non sono affatto rovine romane autentiche! Furono costruite come un capriccio di Maria Teresa, un elemento scenografico romantico per il parco, che simulava un pezzo d'antichit√†, molto di moda nel Barocco." },
            "Paternoster": { descrizione: "Un tipo di ascensore insolito e antico, a ciclo continuo, presente in alcuni edifici storici. Offre un'esperienza di viaggio unica, quasi meccanica, in un ambiente opulento.", curiosita: "House of Industry: L'edificio √® un bellissimo esempio di architettura tardo-storica viennese ed √® rinomato per aver conservato il suo Paternoster." },
            "Biblioteca Nazionale Austriaca (Prunksaal)": { descrizione: "La 'Sala di Stato' della Biblioteca Nazionale Austriaca, considerata una delle biblioteche storiche pi√π belle del mondo. Ospita oltre 200.000 volumi rilegati in pelle. Un'architettura sontuosa voluta dall'Imperatore Carlo VI.", curiosita: "Le Statue: Le statue che adornano la sala, in particolare quelle al centro, celebrano l'autorit√† dell'Imperatore in quanto difensore della fede e sovrano illuminato." },
            "Chiesa dei Gesuiti (Jesuitenkirche)": { descrizione: "Un gioiello del Barocco viennese, con una facciata relativamente austera che nasconde interni drammaticamente affrescati. I suoi pilastri in marmo artificiale e la cupola illusionistica sono mozzafiato.", curiosita: "Il Trompe-l'oeil della Cupola: L'affresco della cupola √® un capolavoro di Andrea Pozzo, maestro dell'illusione barocca, che la rende apparentemente tridimensionale, un effetto che vale da solo la visita." },
            "Wien Museum Karlsplatz": { descrizione: "Il Museo Storico di Vienna. Riunisce la storia della citt√† dal Medioevo alla modernit√†, dalle armature dei principi ai dipinti di Klimt. Riaperto di recente in un edificio rinnovato, √® un punto di riferimento per capire l'anima di Vienna.", curiosita: "Il Tetto Segreto: Il nuovo edificio del museo √® stato progettato per integrare il vecchio. Una parte del tetto √® spesso accessibile e offre un punto panoramico insolito sulla Karlsplatz." }
        };

        // Dati Budget (Mantenuti uguali)
        const budgetData = [
            { categoria: "Alloggio (3 notti)", costo: 243.00, icon: 'bed' },
            { categoria: "Ingressi & Biglietti (Cultura)", costo: 132.00, icon: 'ticket' },
            { categoria: "Trasporti (Pass 72h + CAT A/R)", costo: 93.40, icon: 'train' }, 
            { categoria: "Cibo & Bevande (Stimato per 4 giorni)", costo: 320.00, icon: 'sandwich' }, // Mantenuto alto per compensare i caff√® e i pranzi centrali
            { categoria: "Spese Varie & Souvenir", costo: 150.00, icon: 'shopping-bag' }
        ];

        let itineraryData = []; 

        // ===========================================
        // 2. LOGICA DI INIZIALIZZAZIONE E RENDERING (Identica)
        // ===========================================
        
        function getIconNameByFocus(focus) {
            const activity = focus.toLowerCase();
            if (activity.includes('volo') || activity.includes('transfer') || activity.includes('bus') || activity.includes('cat') || activity.includes('treno')) return 'train';
            if (activity.includes('pranzo') || activity.includes('cena') || activity.includes('colazione') || activity.includes('cibo') || activity.includes('w√ºrstel') || activity.includes('caf√©') || activity.includes('sacher') || activity.includes('friedlich') || activity.includes('kellergw√∂lb') || activity.includes('kaiserschmarrn')) return 'coffee';
            if (activity.includes('spesa') || activity.includes('mercatino') || activity.includes('shopping') || activity.includes('souvenir') || activity.includes('billa')) return 'shopping-cart';
            if (activity.includes('castello') || activity.includes('hofburg') || activity.includes('sch√∂nbrunn') || activity.includes('biblioteca') || activity.includes('tesoro')) return 'castle';
            if (activity.includes('belvedere') || activity.includes('museum') || activity.includes('arte') || activity.includes('concerto') || activity.includes('showroom')) return 'brush';
            if (activity.includes('hundertwasser') || activity.includes('architettonica') || activity.includes('paternoster') || activity.includes('industry') || activity.includes('gesuiti') || activity.includes('karlskirche')) return 'building-2';
            if (activity.includes('prater') || activity.includes('divertimento')) return 'roller-coaster';
            if (activity.includes('donauturm') || activity.includes('baia') || activity.includes('gloriette') || activity.includes('trekking')) return 'tower';
            if (activity.includes('promemoria') || activity.includes('prenotazione') || activity.includes('cruciale') || activity.includes('recupero')) return 'bell';
            
            return 'circle-dot';
        }

        /**
         * Funzione per creare il link di Google Maps
         * @param {string} location La stringa del luogo da cercare su Google Maps.
         * @returns {string} Il tag <a> HTML per il link.
         */
        function createMapsLink(location) {
            const encodedLocation = encodeURIComponent(location.replace(/\s+/g, ' ').trim());
            // Nota: Ho rimosso l'URL googleusercontent.com per evitare warning, usando un semplice placeholder.
            return `<a href="https://maps.google.com/?q=${encodedLocation}" target="_blank" class="text-blue-600 hover:text-blue-800 underline font-semibold">Ottieni indicazioni su Google Maps</a>`;
        }

        // Funzione per combinare i dati grezzi e arricchirli
        function initializeData() {
            itineraryData = rawItineraryData.map(item => {
                const match = item.giorno.match(/Giorno (\d+)/);
                const giornoNumber = match ? parseInt(match[1]) : 0;
                
                // Il focus prende l'icona
                const focus = getIconNameByFocus(item.attivita + item.focus_raw + item.note);
                
                let culturalInfo = '';
                
                const culturalKeys = Object.keys(culturalMap);
                for (const key of culturalKeys) {
                    // Logica di match per le descrizioni culturali
                    if (item.attivita.includes(key) || item.luogo.includes(key) || 
                        (item.attivita.includes("Prunksaal") && key.includes("Biblioteca Nazionale")) ||
                        (item.attivita.includes("Gloriette") && key.includes("Sch√∂nbrunn")) ||
                        (item.attivita.includes("Kunst Haus Wien") && key.includes("Hundertwasserhaus")) || 
                        (item.luogo.includes("Wien Museum") && key.includes("Wien Museum")) || 
                        (item.luogo.includes("Belvedere") && key.includes("Belvedere")) ||
                        (item.attivita.includes("Chiesa dei Gesuiti") && key.includes("Chiesa dei Gesuiti"))) {
                        const cultData = culturalMap[key];
                        culturalInfo += `<p class="mt-3 font-semibold text-gray-800 border-t pt-2 border-gray-100">Contesto Storico (${key.split(' (')[0]}):</p>`;
                        culturalInfo += `<p class="text-gray-700">${cultData.descrizione}</p>`;
                        culturalInfo += `<p class="italic text-gray-600 mt-1"><span class="accent-color">Curiosit√†:</span> ${cultData.curiosita}</p>`;
                        break; 
                    }
                }

                const mapsLink = createMapsLink(item.luogo);
                const arrivalInfo = `
                    <p class="mt-3 font-semibold text-gray-800 border-t pt-2 border-gray-100">Come arrivare:</p>
                    <p class="text-gray-700">${mapsLink}</p>
                `;

                // Campo dettagli pulito
                const combinedDettagli = `
                    <p class="font-semibold text-gray-800"><span class="accent-color">Note Utili:</span> ${item.note || 'Nessuna nota aggiuntiva.'}</p>
                    <p class="text-gray-700 mt-2"><span class="font-semibold">Contesto & Focus:</span> ${item.focus_raw}</p>
                    ${culturalInfo}
                    ${arrivalInfo}
                `;

                return {
                    giorno: giornoNumber,
                    ora: item.ora,
                    attivita: item.attivita.replace(/\\rightarrow/g, '‚Üí'), 
                    luogo: item.luogo.replace(/\\rightarrow/g, '‚Üí'),
                    focus: focus,
                    note: item.note,
                    dettagli: combinedDettagli
                };
            });
        }

        window.toggleDetails = function(id) {
            const element = document.getElementById(id);
            const button = event.target;
            
            if (element.classList.contains('hidden')) {
                element.classList.remove('hidden');
                button.textContent = 'Nascondi Dettagli';
            } else {
                element.classList.add('hidden');
                button.textContent = 'Mostra Dettagli';
            }
        };

        const navButtons = document.querySelectorAll('.nav-button');
        const pages = document.querySelectorAll('.tab-content');
        
        window.showPage = function(pageId) {
            pages.forEach(page => { page.style.display = 'none'; });
            const targetPage = document.getElementById(pageId);
            if (targetPage) { targetPage.style.display = 'block'; }

            navButtons.forEach(button => { button.classList.remove('active-tab'); });
            const activeButton = document.querySelector(`button[data-page="${pageId}"]`);
            if (activeButton) { activeButton.classList.add('active-tab'); }
        }

        function renderTimeline(day, containerId) {
            const container = document.getElementById(containerId);
            const dailyData = itineraryData.filter(item => item.giorno === day);
            let htmlTimeline = '';

            dailyData.forEach((item, index) => {
                const iconName = item.focus; 
                const uniqueId = `${containerId}-details-${index}`;
                
                // Logica per evidenziare il titolo attivit√† per i giorni effettivi (1, 2, 3 - mattina)
                let activityTitle = item.attivita;
                if (day === 1 || day === 2 || (day === 3 && index < 3)) { // Le prime 3 attivit√† del Giorno 3 sono effettive
                     activityTitle = `<span class="font-extrabold">${item.attivita}</span>`;
                } else if (day === 3) {
                     activityTitle = `<span class="font-semibold italic text-gray-700">Piano:</span> ${item.attivita}`;
                }

                htmlTimeline += `
                    <div class="timeline-item relative py-4">
                        <div class="timeline-point absolute -left-0.5 top-6 w-3 h-3 rounded-full z-10"></div>
                        <div class="bg-white p-4 ml-4 rounded-lg shadow-md hover:shadow-xl transition duration-300 transform hover:scale-[1.01]">
                            <div class="flex items-start mb-2 justify-between">
                                <div class="flex items-center">
                                    <i data-lucide="${iconName}" class="w-5 h-5 mr-3 accent-color shrink-0"></i>
                                    <span class="font-bold text-lg">${activityTitle}</span>
                                </div>
                                 <span class="text-sm font-semibold text-gray-500">${item.ora}</span>
                            </div>
                            <p class="text-sm text-gray-700 mb-2 pl-8">üìç ${item.luogo.replace(/\\rightarrow/g, '‚Üí')}</p>
                            
                            <button 
                                class="details-btn text-xs font-semibold text-white py-1 px-3 rounded-full mt-2 no-print"
                                onclick="toggleDetails('${uniqueId}')"
                            >
                                Mostra Dettagli
                            </button>
                            <div id="${uniqueId}" class="hidden mt-3 pt-3 text-sm">
                                ${item.dettagli}
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = htmlTimeline;
        }

        function renderSummary() {
            const summaryContainer = document.getElementById('summary-container');
            let htmlSummary = '';
            let lastDay = 0;

            itineraryData.forEach(item => {
                if (item.giorno !== lastDay) {
                    htmlSummary += `
                        <h3 class="text-xl font-bold mt-6 pb-1 border-b-2 border-gray-300 accent-color">
                            Giorno ${item.giorno}
                        </h3>
                        <ul class="list-disc list-inside space-y-1 ml-4">
                    `;
                    lastDay = item.giorno;
                }
                
                htmlSummary += `
                    <li class="text-gray-700">
                        <span class="font-semibold">${item.ora}:</span> ${item.attivita} (<span class="italic">${item.luogo.replace(/\\rightarrow/g, '‚Üí')}</span>)
                    </li>
                `;

                if (itineraryData.length === itineraryData.indexOf(item) + 1 || itineraryData[itineraryData.indexOf(item) + 1].giorno !== lastDay) {
                    htmlSummary += `</ul>`;
                }
            });

            summaryContainer.innerHTML = htmlSummary;
        }

        function renderFoodShowcases() {
            const containerMap = {
                "Piatti tipici": "showcase-piatti",
                "Le merende reali": "showcase-merende",
                "Drink": "showcase-drink"
            };

            for (const category in newFoodData) {
                const id = containerMap[category];
                const container = document.getElementById(id);
                let htmlContent = '';

                if (container) {
                    // Preserve the title and start appending
                    let existingTitle = container.querySelector('h3').outerHTML;
                    container.innerHTML = existingTitle; 
                }

                newFoodData[category].forEach(item => {
                    htmlContent += `
                        <div class="bg-gray-50 p-3 rounded-lg mt-3 border border-gray-200">
                            <h4 class="font-bold text-lg">${item.titolo}</h4>
                            <p class="text-sm text-gray-700 mt-1">${item.descrizione}</p>
                            <p class="text-xs text-gray-500 mt-2 italic border-t pt-2">
                                üìç Dove: ${item.indirizzi}
                                <br>
                                üóìÔ∏è Suggerimento: ${item.suggerito}
                            </p>
                        </div>
                    `;
                });
                if (container) {
                     container.innerHTML += htmlContent;
                }
            }
        }

        function renderBudgetAndStats() {
            const costs = budgetData.map(item => item.costo);
            const totalCost = costs.reduce((sum, cost) => sum + cost, 0);
            
            document.getElementById('total-budget-display').textContent = `‚Ç¨ ${totalCost.toFixed(2)}`;
            const kpiContainer = document.getElementById('kpi-summary');
            let htmlKpi = '';
            
            budgetData.forEach(item => {
                 htmlKpi += `
                    <div class="flex items-center">
                        <i data-lucide="${item.icon}" class="w-4 h-4 mr-2 text-gray-700"></i>
                        <span class="font-semibold">${item.categoria}:</span>
                        <span class="ml-auto font-bold">${item.costo.toFixed(2)} ‚Ç¨</span>
                    </div>
                `;
            });
            kpiContainer.innerHTML = htmlKpi;
            
            if (window.matchMedia('print').matches) return;

            const categories = budgetData.map(item => item.categoria.split('(')[0].trim());
            const imperialColors = ['#8C0000', '#C8AA50', '#A52A2A', '#D4AF37', '#B22222'];
            
            const ctx = document.getElementById('budgetChart').getContext('2d');
            
            if (window.budgetChartInstance) {
                window.budgetChartInstance.destroy();
            }

            window.budgetChartInstance = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: categories,
                    datasets: [{
                        data: costs,
                        backgroundColor: imperialColors,
                        borderColor: 'white',
                        borderWidth: 2,
                        hoverOffset: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right' },
                        title: {
                            display: true,
                            text: `Costo Totale Stimato: ‚Ç¨ ${totalCost.toFixed(2)}`,
                            font: { size: 16, family: 'Georgia, serif' },
                            color: getComputedStyle(document.documentElement).getPropertyValue('--color-primary')
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) { label += ': '; }
                                    label += new Intl.NumberFormat('it-IT', { style: 'currency', currency: 'EUR' }).format(context.raw);
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            initializeData();
            renderSummary();
            renderTimeline(1, 'timeline-GIORNO1');
            renderTimeline(2, 'timeline-GIORNO2');
            renderTimeline(3, 'timeline-GIORNO3');
            renderTimeline(4, 'timeline-GIORNO4');
            renderFoodShowcases();
            renderBudgetAndStats();
            
            lucide.createIcons(); 
            
            showPage('page-GIORNO3'); 
        });
    </script>
</body>
</html>
