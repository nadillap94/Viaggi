<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vienna Imperiale - Guida Interattiva Modulare</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* DESIGN SYSTEM IMPERIALE */
        :root {
            --color-primary: #8C0000; /* Bordeaux Scuro (rich red) */
            --color-secondary: #C8AA50; /* Oro Antico (muted gold) */
            --color-background: #FAF8F4; /* Crema/Bianco Sporco */
            --color-text: #2c2c2c;
            --color-nav-bg: #4A4A4A; /* Grigio scuro per la navbar */
        }

        body {
            font-family: 'Georgia', serif;
            background-color: var(--color-background);
            color: var(--color-text);
        }

        /* HEADER & NAV BAR */
        .header-bg {
            background-color: var(--color-primary);
            color: white;
            border-bottom: 6px solid var(--color-secondary);
        }
        .nav-bg {
            background-color: var(--color-nav-bg); /* Sfondo scuro per il menu tab */
        }
        .nav-button {
            transition: all 0.2s;
            /* Rimosso lo stile per la classe '.fixed-header' non necessaria */
        }
        .nav-button:hover {
            background-color: #6C0000;
        }
        .active-tab { /* Stile per la tab selezionata */
            background-color: var(--color-primary);
            font-weight: bold;
            border-bottom: 3px solid var(--color-secondary);
        }

        /* ... Stili Timeline e Cibo invariati ... */
        .accent-color { color: var(--color-primary); }
        .border-accent { border-color: var(--color-secondary); }
        .timeline-item { border-left: 2px solid var(--color-secondary); }
        .timeline-point {
            background-color: var(--color-primary);
            border: 4px solid var(--color-secondary);
        }
        .details-btn { background-color: var(--color-primary); }
        .details-btn:hover { background-color: #6C0000; }
        .food-showcase {
            background-color: white;
            border-top: 5px solid var(--color-primary);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        /* SEZIONI PAGINA */
        .tab-content {
            display: none; /* Nasconde tutte le sezioni di default */
            min-height: 80vh; 
        }
        
        /* OTTIMIZZAZIONE PER LA STAMPA (PDF) - Rimosse classi non necessarie */
        @media print {
            body { background-color: white !important; color: black !important; font-size: 10pt; }
            /* Nasconde la navigazione e i pulsanti dinamici */
            .fixed-element, .no-print { display: none !important; }
            .header-bg {
                background-color: white !important; color: black !important;
                border-bottom: 1px solid black !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .timeline-item { border-left: 1px dashed gray; }
            .timeline-point { background-color: white !important; border-color: black !important; }
            
            /* Forza la visualizzazione di TUTTI i dettagli espandibili in stampa */
            .tab-content { display: block !important; } 
            .hidden { display: block !important; } 
            
            /* Stile per le sezioni stampate sequenzialmente (margine tra le tab) */
            #page-PANORAMICA, #page-GIORNO1, #page-GIORNO2, #page-GIORNO3, #page-GIORNO4, #page-CIBO, #page-BUDGET {
                 page-break-after: always;
            }
            #page-BUDGET { page-break-after: avoid; }
        }
    </style>
</head>
<body onload="showPage('page-PANORAMICA')">

    <header class="header-bg shadow-lg fixed top-0 w-full z-50 fixed-element">
        <div class="max-w-6xl mx-auto px-4 py-3">
            <h1 class="text-3xl font-extrabold tracking-wider text-center">GUIDA VIENNA: L'EFFICACIA IMPERIALE</h1>
        </div>
    </header>

    <nav class="nav-bg fixed top-[58px] w-full z-40 shadow-xl fixed-element">
        <div class="max-w-6xl mx-auto px-4">
            <div class="flex flex-wrap justify-center gap-1 text-sm md:text-base">
                <button onclick="showPage('page-PANORAMICA')" class="nav-button px-3 py-2 text-white" data-page="page-PANORAMICA">PANORAMICA</button>
                <button onclick="showPage('page-GIORNO1')" class="nav-button px-3 py-2 text-white" data-page="page-GIORNO1">GIORNO 1: VENERD√å 5</button>
                <button onclick="showPage('page-GIORNO2')" class="nav-button px-3 py-2 text-white" data-page="page-GIORNO2">GIORNO 2: SABATO 6</button>
                <button onclick="showPage('page-GIORNO3')" class="nav-button px-3 py-2 text-white" data-page="page-GIORNO3">GIORNO 3: DOMENICA 7</button>
                <button onclick="showPage('page-GIORNO4')" class="nav-button px-3 py-2 text-white" data-page="page-GIORNO4">GIORNO 4: LUNED√å 8</button>
                <button onclick="showPage('page-CIBO')" class="nav-button px-3 py-2 text-white" data-page="page-CIBO">CIBO</button>
                <button onclick="showPage('page-BUDGET')" class="nav-button px-3 py-2 text-white" data-page="page-BUDGET">BUDGET E STATISTICHE</button>
            </div>
        </div>
    </nav>
    
    <div class="h-[95px] md:h-[105px] fixed-element no-print"></div>

    <main class="max-w-6xl mx-auto p-4 sm:p-6 lg:p-8">

        <section id="page-PANORAMICA" class="tab-content">
            <h2 class="text-3xl font-bold mb-6 pb-2 border-b border-accent accent-color flex items-center">
                <i data-lucide="scan" class="mr-2 text-2xl"></i> Panoramica Veloce: L'Essenza del Viaggio
            </h2>
            <div id="summary-container" class="space-y-6">
                </div>
        </section>

        <section id="page-GIORNO1" class="tab-content">
            <h2 class="text-3xl font-bold mb-8 pb-2 border-b border-accent accent-color flex items-center">
                <i data-lucide="calendar-check" class="mr-2 text-2xl"></i> Giorno 1: Venerd√¨ 5 - Arrivo e Centro Storico
            </h2>
            <p class="text-lg mb-6 bg-white p-4 rounded-lg shadow-md border-l-4 border-accent">
                **Intro:** Il focus √® sull'assestamento logistico e l'immediata immersione nel cuore imperiale di Vienna (1010), chiudendo con il primo mercatino.
            </p>
            <div id="timeline-GIORNO1" class="relative"></div>
        </section>
        <section id="page-GIORNO2" class="tab-content">
            <h2 class="text-3xl font-bold mb-8 pb-2 border-b border-accent accent-color flex items-center">
                <i data-lucide="calendar-check" class="mr-2 text-2xl"></i> Giorno 2: Sabato 6 - Grand Tour di Sfarzo
            </h2>
            <p class="text-lg mb-6 bg-white p-4 rounded-lg shadow-md border-l-4 border-accent">
                **Intro:** Giorno dedicato alle due principali residenze imperiali (Sch√∂nbrunn e Belvedere) e ai mercatini pi√π maestosi.
            </p>
            <div id="timeline-GIORNO2" class="relative"></div>
        </section>
        <section id="page-GIORNO3" class="tab-content">
            <h2 class="text-3xl font-bold mb-8 pb-2 border-b border-accent accent-color flex items-center">
                <i data-lucide="calendar-check" class="mr-2 text-2xl"></i> Giorno 3: Domenica 7 - Arte, Follia e Intimit√†
            </h2>
            <p class="text-lg mb-6 bg-white p-4 rounded-lg shadow-md border-l-4 border-accent">
                **Intro:** Un mix tra la grandezza dell'Hofburg, la modernit√† stravagante di Hundertwasser e la calma del mercatino di Spittelberg.
            </p>
            <div id="timeline-GIORNO3" class="relative"></div>
        </section>
        <section id="page-GIORNO4" class="tab-content">
            <h2 class="text-3xl font-bold mb-8 pb-2 border-b border-accent accent-color flex items-center">
                <i data-lucide="calendar-check" class="mr-2 text-2xl"></i> Giorno 4: Luned√¨ 8 - Saluti e Partenza
            </h2>
            <p class="text-lg mb-6 bg-white p-4 rounded-lg shadow-md border-l-4 border-accent">
                **Intro:** Ultimo giorno dedicato al famoso Prater per un tocco finale di nostalgia prima del transfer.
            </p>
            <div id="timeline-GIORNO4" class="relative"></div>
        </section>
        <section id="page-CIBO" class="tab-content">
            <h2 class="text-3xl font-bold mb-8 pb-2 border-b border-accent accent-color flex items-center">
                <i data-lucide="utensils" class="mr-2 text-2xl"></i> Delizie Culinarie di Vienna
            </h2>
            <div id="food-showcases" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div id="showcase-piattitipici" class="food-showcase p-5 rounded-xl">
                    <h3 class="text-2xl font-bold accent-color mb-4">üçΩÔ∏è Piatti Tipici (Pranzi & Cene)</h3>
                </div>
                <div id="showcase-lemerendareali" class="food-showcase p-5 rounded-xl">
                    <h3 class="text-2xl font-bold accent-color mb-4">üç∞ Le Merende Reali (Dolci & Caf√©)</h3>
                </div>
                <div id="showcase-drink" class="food-showcase p-5 rounded-xl">
                    <h3 class="text-2xl font-bold accent-color mb-4">‚òï Drink (Caldi & Mercatino)</h3>
                </div>
            </div>
        </section>
        <section id="page-BUDGET" class="tab-content">
            <h2 class="text-3xl font-bold mb-8 pb-2 border-b border-accent accent-color flex items-center">
                <i data-lucide="wallet" class="mr-2 text-2xl"></i> Analisi Budget e Statistiche
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="md:col-span-1 bg-white p-6 rounded-xl shadow-xl border-l-4 border-accent">
                    <h3 class="text-xl font-bold accent-color mb-4">Riepilogo Totale</h3>
                    <p class="text-4xl font-extrabold" id="total-budget-display">‚Ç¨ XXX.XX</p>
                    <p class="text-sm mt-2 text-gray-600">Costo stimato per persona (esclusi voli).</p>
                    <div id="kpi-summary" class="mt-6 space-y-3 text-sm">
                    </div>
                </div>
                <div class="md:col-span-2 bg-white p-6 rounded-xl shadow-xl border-l-4 border-accent no-print">
                    <h3 class="text-xl font-bold accent-color mb-4">Ripartizione Costi (Grafico)</h3>
                    <div class="chart-container" style="height: 350px;">
                        <canvas id="budgetChart"></canvas>
                    </div>
                    <p class="text-center text-sm mt-4 italic text-gray-500">I costi sono stimati e arrotondati.</p>
                </div>
            </div>
        </section>

    </main>
    
    <script>
        // Inizializza le icone Lucide
        lucide.createIcons();
        // ... (DATI, FUNZIONI DI UTILITY, LOGICA SPA e FUNZIONI DI RENDERING INVARIATE) ...

        const itineraryData = [
            // Giorno 1: Venerd√¨ 5
            { giorno: 1, ora: "09:00 - 14:00", attivita: "Viaggio, Transfer, Check-in, Pranzo", luogo: "Leopoldstadt (2¬∞ distretto)", focus: "Trasporto", note: "Pranzo Low-Cost: Sfrutta un piccolo Imbiss in zona alloggio (1020).", dettagli: "Gestione logistica del primo giorno. Acquisto dell'abbonamento 72h per i mezzi pubblici (se necessario)." },
            { giorno: 1, ora: "14:00 - 17:00", attivita: "Centro Storico (1010): Duomo e Passeggiata", luogo: "Stephansdom, Stephansplatz 3, 1010 Wien", focus: "Passeggiata/Architettura", note: "La Cattedrale di Santo Stefano √® il simbolo gotico della citt√†. Focus fotografico.", dettagli: "Visita all'esterno e all'interno. Salita opzionale sulla torre sud per la vista panoramica sul centro." },
            { giorno: 1, ora: "17:00 - 18:00", attivita: "Mercatino Stephansplatz (1¬∞)", luogo: "Stephansplatz, 1010 Wien", focus: "Shopping/Bevande", note: "Primo Gl√ºhwein per scaldarsi e immergersi nell'atmosfera.", dettagli: "Mercatino piccolo ma scenografico, proprio di fronte al Duomo." },
            { giorno: 1, ora: "20:00 - 22:00", attivita: "Cena: Beim Czaak (Wiener Schnitzel)", luogo: "Beim Czaak, Am Heumarkt 10, 1030 Wien", focus: "Cibo", note: "Uno dei migliori Beisl per il Schnitzel autentico (di vitello). Prenotazione consigliata.", dettagli: "Ritorno in alloggio dopo cena." },
            
            // Giorno 2: Sabato 6
            { giorno: 2, ora: "10:00 - 14:00", attivita: "Palazzo di Sch√∂nbrunn", luogo: "Sch√∂nbrunner Schlo√üstra√üe 47, 1130 Wien", focus: "Cultura", note: "Visita del 'Grand Tour' e dei giardini. Durata stimata: 4h.", dettagli: "Arrivo con la U4. Visita degli appartamenti di Sissi e Francesco Giuseppe. Pranzo veloce al mercatino del palazzo." },
            { giorno: 2, ora: "15:00 - 17:30", attivita: "Belvedere e Klimt", luogo: "Prinz-Eugen-Stra√üe 27, 1030 Wien", focus: "Arte", note: "Visita al Belvedere Superiore per vedere 'Il Bacio' di Klimt. T.T. = 2.5h.", dettagli: "Fermata del tram D. Dopo la visita, breve passeggiata nei giardini barocchi." },
            { giorno: 2, ora: "17:30 - 19:00", attivita: "Mercatino di Maria-Theresien Platz", luogo: "Maria-Theresien-Platz, 1010 Wien", focus: "Shopping/Bevande", note: "Mercatino tra i due grandi musei (Naturhistorisches e Kunsthistorisches).", dettagli: "Ideale per foto serali scenografiche." },
            { giorno: 2, ora: "20:00 - 22:00", attivita: "Cena: Anzengruber (Gulasch)", luogo: "Anzengruber, Schleifm√ºhlgasse 19, 1040 Wien", focus: "Cibo", note: "Famoso per il Gulasch e l'atmosfera autentica (Wieden, 1040).", dettagli: "Locale piccolo e molto tradizionale." },

            // Giorno 3: Domenica 7
            { giorno: 3, ora: "9:30 - 12:30", attivita: "Hofburg e Biblioteca Nazionale", luogo: "Michaelerplatz, 1010 Wien", focus: "Cultura/Architettura", note: "Visita agli appartamenti e al Museo di Sissi. Imperdibile la Sala di Stato della Biblioteca.", dettagli: "La biblioteca √® considerata una delle pi√π belle del mondo." },
            { giorno: 3, ora: "13:00 - 14:00", attivita: "Pranzo: Naschmarkt", luogo: "Wienzeile, 1060 Wien", focus: "Cibo", note: "Pranzo veloce al mercato (es. Bosna dal Balkan Grill).", dettagli: "Mercato eclettico di cibo e antiquariato." },
            { giorno: 3, ora: "15:00 - 17:00", attivita: "Hundertwasserhaus e Villaggio", luogo: "Kegelgasse 34-38, 1030 Wien", focus: "Architettura", note: "Il palazzo colorato e asimmetrico come manifesto anti-linea retta.", dettagli: "Non visitabile all'interno, ma il villaggio di fronte √® un bel mercatino souvenir." },
            { giorno: 3, ora: "17:30 - 20:00", attivita: "Rathausplatz (Il Gigante)", luogo: "Rathausplatz, 1010 Wien", focus: "Shopping/Bevande", note: "Il mercatino pi√π grande e famoso. Molto affollato ma spettacolare per le luci.", dettagli: "Nonostante la folla, l'ambientazione nel parco del Municipio √® imperdibile." },
            { giorno: 3, ora: "20:30 - 22:30", attivita: "Cena: Mercatino di Spittelberg", luogo: "Spittelberggasse, 1070 Wien", focus: "Cibo/Atmosfera", note: "Cena nel mercatino pi√π intimo e romantico, nascosto tra i vicoli del 1070.", dettagli: "Perfetto per chiudere la serata con calma." },

            // Giorno 4: Luned√¨ 8
            { giorno: 4, ora: "9:30 - 11:30", attivita: "Prater e Riesenrad", luogo: "Prater, 1020 Wien", focus: "Attrazione", note: "Il parco divertimenti storico. Giro sulla Ruota Panoramica (Riesenrad).", dettagli: "La ruota panoramica offre una vista a 360 gradi sulla citt√†." },
            { giorno: 4, ora: "11:30 - 13:00", attivita: "Pranzo: K√§sekrainer al chiosco", luogo: "Bitzinger W√ºrstelstand, Prater, 1020 Wien", focus: "Cibo", note: "Ultimo pranzo veloce: K√§sekrainer (salsiccia ripiena di formaggio).", dettagli: "Uno dei chioschi di salsicce pi√π famosi, situato vicino all'entrata del Prater." },
            { giorno: 4, ora: "14:00 - 17:00", attivita: "Transfer e Partenza", luogo: "Vienna Hauptbahnhof / Aeroporto", focus: "Trasporto", note: "Trasferimento in treno (S7 o CAT) all'aeroporto.", dettagli: "Assicurati di lasciare tempo sufficiente per l'aeroporto (VIE)." }
        ];

        const foodData = {
            "Piatti tipici": [
                { titolo: "Wiener Schnitzel", descrizione: "Cotoletta viennese DOC di vitello, sottile e fritta in abbondante burro.", indirizzi: "Beim Czaak (1030), Figlm√ºller (1010, affollato)." },
                { titolo: "Tafelspitz", descrizione: "Bollito di manzo in brodo con rafano e patate, il piatto preferito di Francesco Giuseppe.", indirizzi: "Plachutta Gasthaus zur Oper (1010)." },
                { titolo: "Gulasch", descrizione: "Stufato ungherese di manzo speziato con paprika, servito con semmelkn√∂del (canederli di pane).", indirizzi: "Anzengruber (1040), P√ºrstner (1010)." },
                { titolo: "K√§sekrainer", descrizione: "Salsiccia ripiena di formaggio fuso (Emmentaler), servita con senape dolce o rafano.", indirizzi: "Ogni chiosco W√ºrstelstand di alta qualit√†, es. Bitzinger." }
            ],
            "Le merende reali": [
                { titolo: "Sachertorte", descrizione: "Torta al cioccolato fondente e confettura di albicocche. La pi√π famosa di Vienna.", indirizzi: "Hotel Sacher o Caf√© Demel (rivali storici)." },
                { titolo: "Apfelstrudel", descrizione: "Strudel di mele sottile con uvetta e cannella, spesso servito caldo con salsa alla vaniglia.", indirizzi: "Caf√© Landtmann, Palmenhaus." },
                { titolo: "Kaiserschmarrn", descrizione: "Frittata dolce e strapazzata, servita con composta di prugne o mele. Piatto imperiale.", indirizzi: "Molti Beisl e ristoranti, es. Ofner." }
            ],
            "Drink": [
                { titolo: "Gl√ºhwein", descrizione: "Vino rosso caldo speziato (cannella, chiodi di garofano), bevanda essenziale dei mercatini.", indirizzi: "Qualsiasi mercatino di Natale (Rathausplatz, Spittelberg)." },
                { titolo: "Punsch", descrizione: "Bevanda calda pi√π forte del Gl√ºhwein, a base di t√®, rum e succo di frutta (spesso arancia).", indirizzi: "Popolare nei chioschi, attenzione al tasso alcolico!" },
                { titolo: "Caff√® Viennese", descrizione: "Il famoso caff√® con panna (Wiener Melange, Einsp√§nner, Kapuziner) da gustare in un Caf√© storico.", indirizzi: "Caf√© Central, Caf√© Sacher, Caf√© Landtmann." }
            ]
        };

        const budgetData = [
            { categoria: "Alloggio (3 notti)", costo: 243.00, icon: 'bed' },
            { categoria: "Ingressi & Biglietti (Cultura)", costo: 132.00, icon: 'ticket' },
            { categoria: "Trasporti (Abbonamenti e Transfer)", costo: 69.40, icon: 'train' },
            { categoria: "Cibo & Bevande (Stimato per 4 giorni)", costo: 320.00, icon: 'sandwich' },
            { categoria: "Spese Varie & Souvenir", costo: 150.00, icon: 'shopping-bag' }
        ];

        function getIconNameByFocus(focus) {
            const focusMap = {
                'Cultura': 'castle',
                'Arte': 'brush',
                'Passeggiata/Architettura': 'map-pin',
                'Architettura': 'building-2',
                'Trasporto': 'train',
                'Shopping/Bevande': 'shopping-cart',
                'Attrazione': 'sparkles',
                'Cibo': 'coffee',
                default: 'circle-dot'
            };
            const normalizedFocus = focus.split('/')[0].trim();
            return focusMap[normalizedFocus] || focusMap.default;
        }
        
        window.toggleDetails = function(id) {
            const element = document.getElementById(id);
            const button = event.target;
            
            if (element.classList.contains('hidden')) {
                element.classList.remove('hidden');
                button.textContent = 'Nascondi Dettagli';
            } else {
                element.classList.add('hidden');
                button.textContent = 'Mostra Dettagli';
            }
        };

        const navButtons = document.querySelectorAll('.nav-button');
        const pages = document.querySelectorAll('.tab-content');
        
        window.showPage = function(pageId) {
            pages.forEach(page => {
                page.style.display = 'none';
            });
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.style.display = 'block';
            }

            navButtons.forEach(button => {
                button.classList.remove('active-tab');
            });
            const activeButton = document.querySelector(`button[data-page="${pageId}"]`);
            if (activeButton) {
                activeButton.classList.add('active-tab');
            }
        }

        function renderTimeline(day, containerId) {
            const container = document.getElementById(containerId);
            const dailyData = itineraryData.filter(item => item.giorno === day);
            let htmlTimeline = '';

            dailyData.forEach((item, index) => {
                const iconName = getIconNameByFocus(item.focus);
                const uniqueId = `${containerId}-details-${index}`;
                
                htmlTimeline += `
                    <div class="timeline-item relative py-4">
                        <div class="timeline-point absolute -left-0.5 top-6 w-3 h-3 rounded-full z-10"></div>
                        <div class="bg-white p-4 ml-4 rounded-lg shadow-md hover:shadow-xl transition duration-300 transform hover:scale-[1.01]">
                            <div class="flex items-start mb-2 justify-between">
                                <div class="flex items-center">
                                    <i data-lucide="${iconName}" class="w-5 h-5 mr-3 accent-color shrink-0"></i>
                                    <span class="font-bold text-lg accent-color">${item.attivita}</span>
                                </div>
                                 <span class="text-sm font-semibold text-gray-500">${item.ora}</span>
                            </div>
                            <p class="text-sm text-gray-700 mb-2 pl-8">üìç ${item.luogo}</p>
                            
                            <button 
                                class="details-btn text-xs font-semibold text-white py-1 px-3 rounded-full mt-2 no-print"
                                onclick="toggleDetails('${uniqueId}')"
                            >
                                Mostra Dettagli
                            </button>
                            <div id="${uniqueId}" class="hidden mt-3 pt-3 border-t border-gray-100 text-sm">
                                <p class="font-semibold text-gray-800"><span class="accent-color">Focus:</span> ${item.focus}</p>
                                <p class="italic text-gray-600"><span class="accent-color">Note:</span> ${item.note}</p>
                                <p class="text-gray-700 mt-2"><span class="font-semibold">Descrizione Dettagliata:</span> ${item.dettagli}</p>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = htmlTimeline;
            lucide.createIcons();
        }

        function renderSummary() {
            const summaryContainer = document.getElementById('summary-container');
            let htmlSummary = '';
            let lastDay = 0;

            itineraryData.forEach(item => {
                if (item.giorno !== lastDay) {
                    htmlSummary += `
                        <h3 class="text-xl font-bold mt-6 pb-1 border-b-2 border-gray-300 accent-color">
                            Giorno ${item.giorno}
                        </h3>
                        <ul class="list-disc list-inside space-y-1 ml-4">
                    `;
                    lastDay = item.giorno;
                }
                
                htmlSummary += `
                    <li class="text-gray-700">
                        <span class="font-semibold">${item.ora}:</span> ${item.attivita} (<span class="italic">${item.luogo}</span>)
                    </li>
                `;

                if (itineraryData.length === itineraryData.indexOf(item) + 1 || itineraryData[itineraryData.indexOf(item) + 1].giorno !== lastDay) {
                    htmlSummary += `</ul>`;
                }
            });

            summaryContainer.innerHTML = htmlSummary;
        }

        function renderFoodShowcases() {
            for (const category in foodData) {
                // CORREZIONE: Assicura che l'ID del contenitore sia corretto (es. showcase-piattitipici)
                const id = `showcase-${category.toLowerCase().replace(/[^a-z0-9]+/g, '')}`; 
                const container = document.getElementById(id);
                let htmlContent = '';

                foodData[category].forEach(item => {
                    htmlContent += `
                        <div class="bg-gray-50 p-3 rounded-lg mt-3 border border-gray-200">
                            <h4 class="font-bold text-lg">${item.titolo}</h4>
                            <p class="text-sm text-gray-700 mt-1">${item.descrizione}</p>
                            <p class="text-xs text-gray-500 mt-2 italic border-t pt-2">üìç Indirizzi: ${item.indirizzi}</p>
                        </div>
                    `;
                });
                if (container) {
                     container.innerHTML += htmlContent;
                }
            }
        }

        function renderBudgetAndStats() {
            const costs = budgetData.map(item => item.costo);
            const totalCost = costs.reduce((sum, cost) => sum + cost, 0);
            
            document.getElementById('total-budget-display').textContent = `‚Ç¨ ${totalCost.toFixed(2)}`;
            const kpiContainer = document.getElementById('kpi-summary');
            let htmlKpi = '';
            
            budgetData.forEach(item => {
                 htmlKpi += `
                    <div class="flex items-center">
                        <i data-lucide="${item.icon}" class="w-4 h-4 mr-2 text-gray-700"></i>
                        <span class="font-semibold">${item.categoria}:</span>
                        <span class="ml-auto font-bold">${item.costo.toFixed(2)} ‚Ç¨</span>
                    </div>
                `;
            });
            kpiContainer.innerHTML = htmlKpi;
            lucide.createIcons();
            
            if (window.matchMedia('print').matches) return;

            const categories = budgetData.map(item => item.categoria.split('(')[0].trim());
            const imperialColors = ['#8C0000', '#C8AA50', '#A52A2A', '#D4AF37', '#B22222'];
            
            const ctx = document.getElementById('budgetChart').getContext('2d');
            
            const budgetChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: categories,
                    datasets: [{
                        data: costs,
                        backgroundColor: imperialColors,
                        borderColor: 'white',
                        borderWidth: 2,
                        hoverOffset: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right' },
                        title: {
                            display: true,
                            text: `Costo Totale Stimato: ‚Ç¨ ${totalCost.toFixed(2)}`,
                            font: { size: 16, family: 'Georgia, serif' },
                            color: getComputedStyle(document.documentElement).getPropertyValue('--color-primary')
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) { label += ': '; }
                                    label += new Intl.NumberFormat('it-IT', { style: 'currency', currency: 'EUR' }).format(context.raw);
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            renderSummary();
            renderTimeline(1, 'timeline-GIORNO1');
            renderTimeline(2, 'timeline-GIORNO2');
            renderTimeline(3, 'timeline-GIORNO3');
            renderTimeline(4, 'timeline-GIORNO4');
            renderFoodShowcases();
            renderBudgetAndStats();
            showPage('page-PANORAMICA');
        });
    </script>
</body>
</html>
